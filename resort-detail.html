<!-- Apple-Style Ski Dining UI - Resort Detail Page -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Resort - SNOGRUB</title>
    <meta id="metaDescription" name="description" content="Discover the best dining options at ski resorts across North America.">
    <meta id="metaKeywords" name="keywords" content="ski resort, dining, restaurants, après-ski">
    
    <!-- Open Graph / Facebook -->
    <meta id="ogTitle" property="og:title" content="Resort - SNOGRUB">
    <meta id="ogDescription" property="og:description" content="Discover the best dining options at this ski resort.">
    <meta id="ogImage" property="og:image" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta id="twitterTitle" name="twitter:title" content="Resort - SNOGRUB">
    <meta id="twitterDescription" name="twitter:description" content="Discover the best dining options at this ski resort.">
    <meta id="twitterImage" name="twitter:image" content="">
    
    <!-- Structured Data (JSON-LD) for SEO - Will be populated dynamically -->
    <script type="application/ld+json" id="resortSchema">
    {
        "@context": "https://schema.org",
        "@type": "TouristAttraction",
        "name": "Resort Name",
        "image": "",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "",
            "addressRegion": "",
            "addressCountry": "US"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": 0,
            "longitude": 0
        }
    }
    </script>
    
    <!-- TailwindCSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent-blue: #0071e3;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .frosted-glass {
            background: rgba(251, 251, 253, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
        }
        
        * {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #resortMap {
            height: 500px;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }
        
        #trailMap {
            height: 600px;
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #0ea5e9;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.2);
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
        }
        
        /* Winter filter for map tiles */
        #trailMap .leaflet-container {
            background-color: #e0f2fe;
        }
        
        /* Adjust trail colors on ski map to better match legend */
        /* OpenSnowMap standard colors: Green (beginner), Blue (intermediate), Red (advanced), Black (expert) */
        /* Legend colors: Green (#10b981), Blue (#3b82f6), Orange (#f59e0b), Red (#ef4444) */
        /* Note: Since OpenSnowMap uses raster tiles, we apply filters to shift colors closer to legend */
        #trailMap .leaflet-tile-container img {
            /* Apply color adjustments to shift red trails toward orange and enhance visibility */
            filter: 
                /* Hue rotation to shift reds toward orange range */
                hue-rotate(-25deg)
                /* Increase saturation to match legend vibrancy */
                saturate(1.2)
                /* Brightness adjustment for better visibility */
                brightness(1.1)
                /* Contrast to make trails stand out */
                contrast(1.15);
        }
        
        /* Trail Map Legend Styles */
        .trail-legend {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .trail-legend h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #0c4a6e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .trail-legend-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }
        
        .trail-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            color: #0c4a6e;
        }
        
        .trail-legend-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }
        
        /* Winter color scheme for trail difficulties */
        .trail-beginner { background: #10b981; } /* Green for beginners */
        .trail-intermediate { background: #3b82f6; } /* Blue for intermediate */
        .trail-advanced { background: #f59e0b; } /* Orange/Amber for advanced */
        .trail-expert { background: #ef4444; } /* Red for expert */
        
        .stat-card {
            transform: translateY(0);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
        }
        
        /* Animation for stat numbers */
        @keyframes countUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #verticalDropValue,
        #liftsValue,
        #trailsValue,
        #restaurantsValue {
            animation: countUp 0.6s ease-out;
        }
        
        /* Ensure SVG animations are smooth */
        svg {
            shape-rendering: geometricPrecision;
        }
        
        /* Lightbox styles */
        #lightbox {
            display: none;
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
        }
        
        #lightbox.active,
        #lightbox:not(.hidden) {
            display: flex;
        }
        
        #lightbox.hidden {
            display: none;
        }
        
        #lightboxContent {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #lightboxImage {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        #lightboxClose {
            position: absolute;
            top: -40px;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        #lightboxClose:hover {
            background: white;
            transform: scale(1.1);
        }
        
        #lightboxPrev,
        #lightboxNext {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 24px;
            color: #1d1d1f;
        }
        
        #lightboxPrev {
            left: 20px;
        }
        
        #lightboxNext {
            right: 20px;
        }
        
        #lightboxPrev:hover,
        #lightboxNext:hover {
            background: white;
            transform: translateY(-50%) scale(1.1);
        }
        
        .ski-map-thumbnail {
            position: relative;
            aspect-ratio: 4/3;
            overflow: hidden;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: #f3f4f6;
        }
        
        .ski-map-thumbnail:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .ski-map-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .ski-map-thumbnail::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.3) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .ski-map-thumbnail:hover::after {
            opacity: 1;
        }
        
        .ski-map-year {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1;
        }
        
        /* Favorites button styling for resort cards */
        .favorite-button {
            transition: all 0.2s ease;
        }
        
        .favorite-button:hover svg {
            transform: scale(1.1);
        }
        
        .favorite-button.favorited svg {
            animation: favoritePulse 0.3s ease;
        }
        
        @keyframes favoritePulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }
        
        /* Home base button styling */
        #homeBaseBtn {
            transition: all 0.2s ease;
        }
        
        #homeBaseBtn:hover {
            transform: translateY(-1px);
        }
        
        #homeBaseBtn.bg-\\[var\\(--accent-blue\\)\\] {
            background-color: var(--accent-blue) !important;
            color: white !important;
            border-color: var(--accent-blue) !important;
        }
        
        #homeBaseCheckbox:checked {
            accent-color: var(--accent-blue);
        }
        
        /* Logo overlay container - hidden by default */
        .resort-logo-overlay-container {
            display: none !important;
        }
        
        .resort-logo-overlay-container[style*="flex"] {
            display: flex !important;
        }
    </style>
</head>
<body class="bg-white text-gray-900 antialiased">
    
    <!-- Navigation Bar -->
    <nav class="fixed top-0 left-0 right-0 z-50 frosted-glass border-b border-gray-200/50">
        <div class="max-w-7xl mx-auto px-6 sm:px-8">
            <div class="flex items-center justify-between h-14">
                <div class="flex-shrink-0">
                    <a href="index.html" class="text-2xl font-semibold hover:opacity-80 transition-opacity duration-300">
                        <span class="bg-[var(--accent-blue)] text-white px-1">SNO</span><span class="text-[var(--accent-blue)]">GRUB</span>
                    </a>
                </div>
                
                <div class="hidden md:flex items-center space-x-8">
                    <a href="resorts.html" class="text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">
                        Resorts
                    </a>
                    <a href="restaurants.html" class="text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">
                        Restaurants
                    </a>
                    <a href="map.html" class="text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">
                        Map
                    </a>
                    <a href="blog.html" class="text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">
                        Blog
                    </a>
                    <a href="favorites.html" class="text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">
                        Favorites
                    </a>
                    <a href="trips.html" class="text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">
                        Trips
                    </a>
                </div>
                
                <!-- Mobile Menu Button -->
                <button id="mobileMenuButton" class="md:hidden text-gray-600 hover:text-gray-900 transition-colors" aria-label="Menu">
                    <svg id="menuIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                    <svg id="closeIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Mobile Menu Dropdown -->
            <div id="mobileMenu" class="hidden md:hidden border-t border-gray-200/50 bg-white/95 backdrop-blur-lg">
                <div class="px-6 py-4 space-y-4">
                    <a href="resorts.html" class="block text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">Resorts</a>
                    <a href="restaurants.html" class="block text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">Restaurants</a>
                    <a href="map.html" class="block text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">Map</a>
                    <a href="blog.html" class="block text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">Blog</a>
                    <a href="favorites.html" class="block text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">Favorites</a>
                    <a href="trips.html" class="block text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors duration-200">Trips</a>
                </div>
            </div>
        </div>
    </nav>
    
    <script>
        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', () => {
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            const menuIcon = document.getElementById('menuIcon');
            const closeIcon = document.getElementById('closeIcon');
            
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    menuIcon.classList.toggle('hidden');
                    closeIcon.classList.toggle('hidden');
                });
            }
            
            // Close mobile menu when clicking a link
            if (mobileMenu) {
                mobileMenu.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenu.classList.add('hidden');
                        menuIcon.classList.remove('hidden');
                        closeIcon.classList.add('hidden');
                    });
                });
            }
        });
    </script>
    
    <!-- Breadcrumb -->
    <div class="pt-20 pb-4 px-6 sm:px-8 bg-gray-50">
        <div class="max-w-7xl mx-auto">
            <nav class="flex items-center space-x-2 text-sm text-gray-600">
                <a href="index.html" class="hover:text-gray-900 transition-colors">Home</a>
                <span>/</span>
                <span id="breadcrumbResortName" class="text-gray-900">Resort</span>
            </nav>
        </div>
    </div>
    
    <!-- Hero Stats Section -->
    <section id="heroStatsSection" class="py-12 md:py-16 bg-gradient-to-br from-blue-50 via-white to-cyan-50 relative overflow-hidden">
        <!-- Satellite backdrop image -->
        <div id="heroBackdrop" class="absolute inset-0 w-full h-full opacity-25" style="display: none; z-index: 0;">
            <img id="heroBackdropImage" src="" alt="Satellite view" class="w-full h-full object-cover" style="filter: brightness(0.5) saturate(1.3) blur(0.5px); min-height: 100%;">
        </div>
        <!-- Content overlay -->
        <div class="relative z-10">
        <div class="max-w-7xl mx-auto px-6 sm:px-8">
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-3 md:gap-4">
                <!-- Vertical Drop Stat -->
                <div class="stat-card bg-white rounded-xl p-3 md:p-4 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col items-center">
                        <div class="mb-2 md:mb-3 w-full h-20 md:h-24 flex items-center justify-center">
                            <svg id="verticalDropGraphic" class="w-full h-full" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                <!-- Mountain base -->
                                <path d="M 20 100 L 100 40 L 180 100 Z" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2"/>
                                <!-- Vertical drop indicator line -->
                                <line id="dropLine" x1="100" y1="100" x2="100" y2="40" stroke="#0ea5e9" stroke-width="3" stroke-dasharray="5,5" opacity="0">
                                    <animate attributeName="opacity" values="0;1;1;0" dur="2s" repeatCount="indefinite"/>
                                </line>
                                <!-- Measurement arrow -->
                                <g id="dropArrow" opacity="0">
                                    <line x1="100" y1="100" x2="100" y2="40" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowhead)"/>
                                    <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="0.5s" repeatCount="indefinite"/>
                                </g>
                                <!-- Arrow marker definition -->
                                <defs>
                                    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="5" refY="3" orient="auto">
                                        <polygon points="0 0, 10 3, 0 6" fill="#ef4444"/>
                                    </marker>
                                </defs>
                                <!-- Animated altitude meter -->
                                <rect x="160" y="20" width="30" height="80" fill="none" stroke="#0ea5e9" stroke-width="2" rx="2"/>
                                <rect id="altitudeBar" x="162" y="100" width="26" height="0" fill="#0ea5e9" rx="1">
                                    <animate attributeName="height" values="0;60" dur="1.5s" begin="0.3s" fill="freeze"/>
                                    <animate attributeName="y" values="100;40" dur="1.5s" begin="0.3s" fill="freeze"/>
                                </rect>
                                <!-- Altitude label -->
                                <text x="175" y="15" font-size="10" fill="#0ea5e9" text-anchor="middle" font-weight="bold">ft</text>
                            </svg>
                        </div>
                        <div class="text-center">
                            <div id="verticalDropValue" class="text-xl md:text-2xl font-bold text-gray-900 mb-0.5">0</div>
                            <div class="text-xs text-gray-600 font-medium">Vertical Drop</div>
                        </div>
                    </div>
                </div>

                <!-- Number of Lifts Stat -->
                <div class="stat-card bg-white rounded-xl p-3 md:p-4 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col items-center">
                        <div class="mb-2 md:mb-3 w-full h-20 md:h-24 flex items-center justify-center">
                            <svg id="liftsGraphic" class="w-full h-full" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                <!-- Lift tower 1 -->
                                <line x1="30" y1="100" x2="30" y2="30" stroke="#0ea5e9" stroke-width="3"/>
                                <circle cx="30" cy="30" r="4" fill="#0ea5e9"/>
                                <!-- Lift tower 2 -->
                                <line x1="100" y1="100" x2="100" y2="20" stroke="#0ea5e9" stroke-width="3"/>
                                <circle cx="100" cy="20" r="4" fill="#0ea5e9"/>
                                <!-- Lift tower 3 -->
                                <line x1="170" y1="100" x2="170" y2="30" stroke="#0ea5e9" stroke-width="3"/>
                                <circle cx="170" cy="30" r="4" fill="#0ea5e9"/>
                                <!-- Cable line -->
                                <line x1="30" y1="30" x2="170" y2="30" stroke="#64748b" stroke-width="2" stroke-dasharray="3,3"/>
                                <!-- Animated chair lift -->
                                <g id="liftChair" transform="translate(0, 0)">
                                    <rect x="45" y="25" width="20" height="12" fill="#ef4444" rx="2"/>
                                    <circle cx="50" cy="37" r="3" fill="#1e293b"/>
                                    <circle cx="60" cy="37" r="3" fill="#1e293b"/>
                                    <animateTransform attributeName="transform" type="translate" values="0,0; 140,0; 0,0" dur="3s" repeatCount="indefinite"/>
                                </g>
                            </svg>
                        </div>
                        <div class="text-center">
                            <div id="liftsValue" class="text-xl md:text-2xl font-bold text-gray-900 mb-0.5">0</div>
                            <div class="text-xs text-gray-600 font-medium">Lifts</div>
                        </div>
                    </div>
                </div>

                <!-- Number of Trails Stat -->
                <div class="stat-card bg-white rounded-xl p-3 md:p-4 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col items-center">
                        <div class="mb-2 md:mb-3 w-full h-20 md:h-24 flex items-center justify-center">
                            <svg id="trailsGraphic" class="w-full h-full" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                <!-- Mountain background -->
                                <path d="M 0 120 L 0 80 L 50 50 L 100 30 L 150 40 L 200 20 L 200 120 Z" fill="#e0f2fe" opacity="0.3"/>
                                <!-- Trail paths -->
                                <path id="trail1" d="M 20 100 Q 50 70, 80 60" fill="none" stroke="#0ea5e9" stroke-width="4" stroke-linecap="round">
                                    <animate attributeName="stroke-dasharray" values="0,200; 200,0" dur="2s" repeatCount="indefinite"/>
                                </path>
                                <path id="trail2" d="M 40 100 Q 70 75, 100 65" fill="none" stroke="#0ea5e9" stroke-width="4" stroke-linecap="round">
                                    <animate attributeName="stroke-dasharray" values="0,200; 200,0" dur="2s" begin="0.3s" repeatCount="indefinite"/>
                                </path>
                                <path id="trail3" d="M 60 100 Q 90 80, 120 70" fill="none" stroke="#0ea5e9" stroke-width="4" stroke-linecap="round">
                                    <animate attributeName="stroke-dasharray" values="0,200; 200,0" dur="2s" begin="0.6s" repeatCount="indefinite"/>
                                </path>
                                <path id="trail4" d="M 80 100 Q 110 85, 140 75" fill="none" stroke="#0ea5e9" stroke-width="4" stroke-linecap="round">
                                    <animate attributeName="stroke-dasharray" values="0,200; 200,0" dur="2s" begin="0.9s" repeatCount="indefinite"/>
                                </path>
                                <!-- Animated skier -->
                                <g id="skier" transform="translate(20, 100)">
                                    <circle cx="0" cy="0" r="4" fill="#ef4444"/>
                                    <line x1="0" y1="0" x2="-5" y2="8" stroke="#1e293b" stroke-width="2"/>
                                    <line x1="0" y1="0" x2="5" y2="8" stroke="#1e293b" stroke-width="2"/>
                                    <animateTransform attributeName="transform" type="translate" 
                                        values="20,100; 80,60; 20,100" 
                                        dur="2s" 
                                        repeatCount="indefinite"
                                        calcMode="spline"
                                        keySplines="0.42 0 0.58 1; 0.42 0 0.58 1"
                                        keyTimes="0; 0.5; 1"/>
                                </g>
                            </svg>
                        </div>
                        <div class="text-center">
                            <div id="trailsValue" class="text-xl md:text-2xl font-bold text-gray-900 mb-0.5">0</div>
                            <div class="text-xs text-gray-600 font-medium">Trails</div>
                        </div>
                    </div>
                </div>

                <!-- Number of Places to Eat Stat -->
                <div class="stat-card bg-white rounded-xl p-3 md:p-4 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col items-center">
                        <div class="mb-2 md:mb-3 w-full h-20 md:h-24 flex items-center justify-center">
                            <svg id="restaurantsGraphic" class="w-full h-full" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                <!-- Restaurant building 1 -->
                                <rect x="20" y="60" width="30" height="40" fill="#0ea5e9" rx="2"/>
                                <rect x="25" y="70" width="8" height="8" fill="#fbbf24"/>
                                <rect x="37" y="70" width="8" height="8" fill="#fbbf24"/>
                                <!-- Restaurant building 2 -->
                                <rect x="70" y="50" width="30" height="50" fill="#0ea5e9" rx="2">
                                    <animate attributeName="fill" values="#0ea5e9;#fbbf24;#0ea5e9" dur="2s" repeatCount="indefinite"/>
                                </rect>
                                <rect x="75" y="60" width="8" height="8" fill="#fbbf24"/>
                                <rect x="87" y="60" width="8" height="8" fill="#fbbf24"/>
                                <!-- Restaurant building 3 -->
                                <rect x="120" y="55" width="30" height="45" fill="#0ea5e9" rx="2"/>
                                <rect x="125" y="65" width="8" height="8" fill="#fbbf24"/>
                                <rect x="137" y="65" width="8" height="8" fill="#fbbf24"/>
                                <!-- Animated fork and knife -->
                                <g id="utensils" transform="translate(100, 30)">
                                    <path d="M 0 0 L 0 20 M -3 5 L 3 5 M -2 10 L 2 10" stroke="#ef4444" stroke-width="2" stroke-linecap="round"/>
                                    <path d="M 8 0 L 8 20 M 5 8 L 11 8" stroke="#ef4444" stroke-width="2" stroke-linecap="round"/>
                                    <animateTransform attributeName="transform" type="translate" values="100,30; 100,20; 100,30" dur="1.5s" repeatCount="indefinite"/>
                                </g>
                                <!-- Floating food icons -->
                                <circle cx="50" cy="40" r="3" fill="#fbbf24" opacity="0.7">
                                    <animate attributeName="cy" values="40;30;40" dur="2s" repeatCount="indefinite"/>
                                    <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                                </circle>
                                <circle cx="150" cy="45" r="3" fill="#fbbf24" opacity="0.7">
                                    <animate attributeName="cy" values="45;35;45" dur="2s" begin="0.5s" repeatCount="indefinite"/>
                                    <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" begin="0.5s" repeatCount="indefinite"/>
                                </circle>
                            </svg>
                        </div>
                        <div class="text-center">
                            <div id="restaurantsValue" class="text-xl md:text-2xl font-bold text-gray-900 mb-0.5">0</div>
                            <div class="text-xs text-gray-600 font-medium">Places to Eat</div>
                        </div>
                    </div>
                </div>

                <!-- Elevation Stat -->
                <div class="stat-card bg-white rounded-xl p-3 md:p-4 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col items-center">
                        <div class="mb-2 md:mb-3 w-full h-20 md:h-24 flex items-center justify-center">
                            <svg id="elevationGraphic" class="w-full h-full" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                <!-- Mountain silhouette -->
                                <path d="M 0 120 L 0 100 L 40 80 L 80 50 L 120 30 L 160 40 L 200 20 L 200 120 Z" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2"/>
                                <!-- Base elevation marker -->
                                <line x1="20" y1="100" x2="20" y2="120" stroke="#10b981" stroke-width="3" stroke-linecap="round"/>
                                <circle cx="20" cy="100" r="4" fill="#10b981"/>
                                <text x="20" y="125" font-size="8" fill="#10b981" text-anchor="middle" font-weight="bold">Base</text>
                                <!-- Summit elevation marker -->
                                <line x1="120" y1="30" x2="120" y2="10" stroke="#ef4444" stroke-width="3" stroke-linecap="round"/>
                                <circle cx="120" cy="30" r="4" fill="#ef4444"/>
                                <text x="120" y="8" font-size="8" fill="#ef4444" text-anchor="middle" font-weight="bold">Summit</text>
                                <!-- Elevation difference line -->
                                <line x1="20" y1="100" x2="120" y2="30" stroke="#64748b" stroke-width="2" stroke-dasharray="4,4" opacity="0.6">
                                    <animate attributeName="opacity" values="0.3;0.6;0.3" dur="2s" repeatCount="indefinite"/>
                                </line>
                            </svg>
                        </div>
                        <div class="text-center">
                            <div id="elevationValue" class="text-xl md:text-2xl font-bold text-gray-900 mb-0.5">—</div>
                            <div class="text-xs text-gray-600 font-medium">Elevation</div>
                        </div>
                    </div>
                </div>

                <!-- Season Status Stat -->
                <div class="stat-card bg-white rounded-xl p-3 md:p-4 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col items-center">
                        <div class="mb-2 md:mb-3 w-full h-20 md:h-24 flex items-center justify-center">
                            <svg id="seasonGraphic" class="w-full h-full" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                <!-- Snowflake for winter/season -->
                                <g transform="translate(100, 60)">
                                    <line x1="0" y1="0" x2="0" y2="20" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round">
                                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/>
                                    </line>
                                    <line x1="0" y1="0" x2="-15" y2="-15" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round">
                                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" begin="0.3s" repeatCount="indefinite"/>
                                    </line>
                                    <line x1="0" y1="0" x2="15" y2="-15" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round">
                                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" begin="0.6s" repeatCount="indefinite"/>
                                    </line>
                                    <line x1="0" y1="0" x2="-15" y2="15" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round">
                                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" begin="0.9s" repeatCount="indefinite"/>
                                    </line>
                                    <line x1="0" y1="0" x2="15" y2="15" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round">
                                        <animate attributeName="opacity" values="0.5;1;0.5" dur="2s" begin="1.2s" repeatCount="indefinite"/>
                                    </line>
                                    <circle cx="0" cy="0" r="4" fill="#0ea5e9">
                                        <animate attributeName="opacity" values="0.7;1;0.7" dur="2s" repeatCount="indefinite"/>
                                    </circle>
                                </g>
                                <!-- Status indicator circle -->
                                <circle id="seasonIndicator" cx="100" cy="100" r="8" fill="#10b981" opacity="1">
                                    <animate attributeName="opacity" values="0.7;1;0.7" dur="1.5s" repeatCount="indefinite"/>
                                </circle>
                            </svg>
                        </div>
                        <div class="text-center">
                            <div id="seasonValue" class="text-xl md:text-2xl font-bold text-gray-900 mb-0.5">—</div>
                            <div class="text-xs text-gray-600 font-medium">Season</div>
                        </div>
                    </div>
                </div>

                <!-- SNOGRUB Rating Stat -->
                <div class="stat-card bg-white rounded-xl p-3 md:p-4 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col items-center">
                        <div class="mb-2 md:mb-3 w-full h-20 md:h-24 flex items-center justify-center">
                            <svg id="ratingGraphic" class="w-full h-full" viewBox="0 0 200 120" xmlns="http://www.w3.org/2000/svg">
                                <!-- Star background -->
                                <path d="M 100 20 L 105 35 L 120 35 L 108 45 L 112 60 L 100 52 L 88 60 L 92 45 L 80 35 L 95 35 Z" 
                                      fill="#fbbf24" opacity="0.3" stroke="#fbbf24" stroke-width="1"/>
                                <!-- Animated star -->
                                <path id="ratingStar" d="M 100 40 L 103 48 L 111 48 L 105 53 L 107 61 L 100 57 L 93 61 L 95 53 L 89 48 L 97 48 Z" 
                                      fill="#fbbf24" opacity="0">
                                    <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="0.5s" repeatCount="indefinite"/>
                                    <animateTransform attributeName="transform" type="scale" values="0.8;1.1;0.8" dur="2s" begin="0.5s" repeatCount="indefinite" additive="sum"/>
                                </path>
                                <!-- Rating text placeholder -->
                                <text x="100" y="85" font-size="24" fill="#fbbf24" text-anchor="middle" font-weight="bold" id="ratingStarText">★</text>
                            </svg>
                        </div>
                        <div class="text-center">
                            <div id="snogrubRatingValue" class="text-xl md:text-2xl font-bold text-gray-900 mb-0.5">—</div>
                            <div class="text-xs text-gray-600 font-medium"><span class="bg-[var(--accent-blue)] text-white px-1">SNO</span><span class="text-[var(--accent-blue)]">GRUB</span> Rating</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Trail Difficulty Breakdown -->
            <div id="trailDifficultySection" class="mt-8 max-w-4xl mx-auto hidden">
                <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
                    <p class="text-sm font-semibold text-gray-700 mb-3">Trail Difficulty</p>
                    <div class="flex items-center gap-1 h-3 bg-gray-200 rounded-full overflow-hidden">
                        <div id="trailBeginnerBar" class="h-full bg-green-400" style="width: 0%" title="0% Beginner"></div>
                        <div id="trailIntermediateBar" class="h-full bg-blue-400" style="width: 0%" title="0% Intermediate"></div>
                        <div id="trailAdvancedBar" class="h-full bg-orange-400" style="width: 0%" title="0% Advanced"></div>
                        <div id="trailExpertBar" class="h-full bg-red-500" style="width: 0%" title="0% Expert"></div>
                    </div>
                    <div class="flex items-center justify-between mt-3 text-xs text-gray-600">
                        <span id="trailBeginnerLabel" class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-400"></span> <span id="trailBeginnerPercent">0</span>%</span>
                        <span id="trailIntermediateLabel" class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-400"></span> <span id="trailIntermediatePercent">0</span>%</span>
                        <span id="trailAdvancedLabel" class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-orange-400"></span> <span id="trailAdvancedPercent">0</span>%</span>
                        <span id="trailExpertLabel" class="flex items-center gap-1 hidden"><span class="w-2 h-2 rounded-full bg-red-500"></span> <span id="trailExpertPercent">0</span>%</span>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>
    
    <!-- Main Content -->
    <section class="py-12 px-6 sm:px-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-12">
                <h1 id="resortName" class="text-4xl sm:text-5xl font-semibold text-gray-900 mb-4 tracking-tight">
                    Resort Name
                </h1>
                <p id="resortLocation" class="text-xl text-gray-600 mb-6">
                    Location
                </p>
                <div class="flex flex-wrap items-center gap-4 mb-4">
                    <div id="seasonStatus" class="flex items-center gap-2 hidden">
                        <!-- Season status badge will be added here -->
                    </div>
                    <div id="resortTagline" class="flex items-center gap-2 hidden">
                        <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span class="text-gray-600"></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span id="restaurantCount" class="text-gray-600">Dining Options</span>
                    </div>
                </div>
                <div class="flex items-center gap-3 flex-wrap">
                    <button id="homeBaseBtn" class="px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-full font-medium hover:bg-gray-50 transition-colors flex items-center gap-2">
                        <input type="checkbox" id="homeBaseCheckbox" class="w-4 h-4 text-[var(--accent-blue)] border-gray-300 rounded focus:ring-[var(--accent-blue)]">
                        <label for="homeBaseCheckbox" class="cursor-pointer flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            <span id="homeBaseLabel">Set as Home Base</span>
                        </label>
                    </button>
                    <button id="addToTripBtn" class="px-6 py-3 bg-[var(--accent-blue)] text-white rounded-full font-medium hover:opacity-90 transition-opacity flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        Add to Trip
                    </button>
                    <button id="shareBtn" class="px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-full font-medium hover:bg-gray-50 transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                        </svg>
                        Share
                    </button>
                    <a id="barsLink" href="#" class="px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-full font-medium hover:bg-gray-50 transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                        Bars
                    </a>
                    <a id="cafesLink" href="#" class="px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-full font-medium hover:bg-gray-50 transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 4h14M5 4v12a2 2 0 002 2h10a2 2 0 002-2V4M5 4H3m16 0h2M8 18h8M8 18v2a2 2 0 002 2h4a2 2 0 002-2v-2M9 6h6M9 8h6"></path>
                        </svg>
                        Cafés
                    </a>
                    <a id="restaurantsLink" href="#" class="px-6 py-3 bg-white text-gray-700 border border-gray-300 rounded-full font-medium hover:bg-gray-50 transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2v20M9 2l3-1 3 1M9 2v20M15 2v20M7 4h2M7 8h2M7 12h2M7 16h2M15 4h2M15 8h2M15 12h2M15 16h2"></path>
                        </svg>
                        Restaurants
                    </a>
                </div>
            </div>
            
            <!-- Today's Info Strip -->
            <div id="todaysInfo" class="mb-10 hidden">
                <div class="flex flex-wrap gap-3 items-center bg-white border border-gray-200 rounded-xl px-4 py-3 shadow-sm">
                    <div id="todayStatus" class="flex items-center gap-2 text-sm font-medium px-3 py-1 rounded-full bg-gray-100 text-gray-800"></div>
                    <div id="todayHours" class="flex items-center gap-2 text-sm text-gray-700 px-3 py-1 rounded-full bg-gray-50">
                        <svg class="w-4 h-4 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Hours: updating...</span>
                    </div>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 114 4h7a4 4 0 100-8h-.5A5.5 5.5 0 106 9"></path>
                        </svg>
                        <span>Today’s weather</span>
                    </button>
                </div>
            </div>
            
            <!-- Overview -->
            <div class="mb-12">
                <h2 class="text-2xl font-semibold text-gray-900 mb-4">Overview</h2>
                <div id="resortDescription" class="text-gray-600 leading-relaxed text-lg space-y-4">
                    <p>Loading resort information...</p>
                </div>
            </div>
            
            <!-- Reviews Section -->
            <div id="reviewsSection" class="mb-12 hidden">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-semibold text-gray-900">Reviews</h2>
                </div>
                
                <!-- SNOGRUB Featured Review -->
                <div id="snogrubFeaturedReview" class="mb-8 bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6 shadow-lg hidden">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-md">
                                SG
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-900"><span class="bg-[var(--accent-blue)] text-white px-1">SNO</span><span class="text-[var(--accent-blue)]">GRUB</span></h3>
                                <p class="text-sm text-gray-600">Professional Ski Resort Enthusiast & Mountain Expert</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="flex items-center" id="snogrubStars">
                                <!-- Stars will be populated dynamically -->
                            </div>
                            <span id="snogrubRating" class="text-lg font-semibold text-gray-900 ml-2">0.0</span>
                        </div>
                    </div>
                    <div id="snogrubReviewContent" class="space-y-4 text-gray-800 leading-relaxed">
                        <!-- Review content will be populated dynamically -->
                    </div>
                    <div id="snogrubSources" class="mt-4 pt-4 border-t border-blue-200 flex items-center gap-4 text-sm text-gray-600 hidden">
                        <span class="font-medium">Sources aggregated:</span>
                        <!-- Source badges will be populated dynamically -->
                    </div>
                </div>
                
                <!-- Review Summaries by Source -->
                <div id="reviewSummariesContainer" class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Review Summaries by Source</h3>
                    <div id="platformReviewsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        <!-- Platform review boxes will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Restaurants at This Resort -->
            <div class="mb-12">
                <h2 id="diningSectionTitle" class="text-2xl font-semibold text-gray-900 mb-4">Dining Options</h2>
                <p id="diningSectionDescription" class="text-gray-600 mb-6 leading-relaxed"></p>
                <div id="restaurantsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Restaurants will be loaded dynamically -->
                </div>
                <div id="loadMoreContainer" class="mt-8 text-center hidden">
                    <button id="loadMoreBtn" class="px-8 py-3 bg-[var(--accent-blue)] text-white rounded-full font-medium hover:opacity-90 transition-opacity">
                        MORE
                    </button>
                </div>
            </div>
            
            <!-- Map -->
            <div class="mb-12">
                <h2 class="text-2xl font-semibold text-gray-900 mb-4">Resort Location</h2>
                <div id="resortMap" class="border border-gray-200 rounded-lg"></div>
            </div>
            
            <!-- Trail Map -->
            <div class="mb-12">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-semibold text-gray-900">Trail Map</h2>
                    <a href="https://openskimap.org/" target="_blank" rel="noopener noreferrer" class="px-4 py-2 bg-[var(--accent-blue)] text-white rounded-lg text-sm font-medium hover:opacity-90 transition-opacity flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                        </svg>
                        View on OpenSkiMap.org
                    </a>
                </div>
                <p class="text-sm text-gray-600 mb-4">Interactive ski trail map showing downhill and cross-country ski trails, lifts, and terrain features.</p>
                
                <!-- Trail Legend -->
                <div class="trail-legend">
                    <h3>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                        </svg>
                        Trail Difficulty Legend
                    </h3>
                    <div class="trail-legend-items">
                        <div class="trail-legend-item">
                            <div class="trail-legend-color trail-beginner"></div>
                            <span>Beginner (Green)</span>
                        </div>
                        <div class="trail-legend-item">
                            <div class="trail-legend-color trail-intermediate"></div>
                            <span>Intermediate (Blue)</span>
                        </div>
                        <div class="trail-legend-item">
                            <div class="trail-legend-color trail-advanced"></div>
                            <span>Advanced (Orange)</span>
                        </div>
                        <div class="trail-legend-item">
                            <div class="trail-legend-color trail-expert"></div>
                            <span>Expert (Red)</span>
                        </div>
                    </div>
                </div>
                
                <div id="trailMap" class="border border-gray-200 rounded-lg"></div>
                <p class="text-xs text-gray-500 mt-2">
                    Trail data from <a href="https://openskimap.org/" target="_blank" class="text-[var(--accent-blue)] hover:underline">OpenSkiMap.org</a> | 
                    Map data © <a href="https://www.openstreetmap.org/" target="_blank" class="text-[var(--accent-blue)] hover:underline">OpenStreetMap</a> contributors ODBL
                </p>
            </div>
            
            <!-- Ski Maps Gallery -->
            <div id="skiMapsSection" class="mb-12 hidden">
                <h2 class="text-2xl font-semibold text-gray-900 mb-4">Ski Maps</h2>
                <p class="text-sm text-gray-600 mb-4">Historical and current ski trail maps from <a id="skimapLink1" href="https://skimap.org/" target="_blank" class="text-[var(--accent-blue)] hover:underline">Skimap.org</a></p>
                <div id="skiMapsGallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- Ski map thumbnails will be loaded here -->
                </div>
                <p class="text-xs text-gray-500 mt-4">
                    Maps courtesy of <a id="skimapLink2" href="https://skimap.org/" target="_blank" class="text-[var(--accent-blue)] hover:underline">Skimap.org</a> - An archive of over 25,000 ski maps from around the world
                </p>
            </div>
            
            <!-- Quick Stats -->
            <div id="quickStats" class="mb-12 grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Quick stats will be loaded dynamically -->
            </div>
            
            <!-- Resort Info -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h2 class="text-2xl font-semibold text-gray-900 mb-4">Resort Information</h2>
                    <div id="resortInfo" class="space-y-4 text-gray-600">
                        <!-- Resort information will be loaded dynamically -->
                    </div>
                </div>
                
                <div>
                    <h2 class="text-2xl font-semibold text-gray-900 mb-4">Getting There</h2>
                    <div id="travelInfo" class="space-y-4 text-gray-600">
                        <!-- Travel information will be loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Closest Resorts Section -->
    <section class="py-16 px-6 sm:px-8 bg-gray-50">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-3xl font-semibold text-gray-900">Closest Resorts</h2>
                <a href="resorts.html" class="text-sm font-medium text-[var(--accent-blue)] hover:opacity-80 transition-opacity flex items-center gap-2">
                    View All Resorts
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            </div>
            <div id="closestResorts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Closest resorts will be loaded dynamically -->
            </div>
        </div>
    </section>
    
    <!-- Eat and Drink Section -->
    <section class="py-16 px-6 sm:px-8 bg-white">
        <div class="max-w-7xl mx-auto">
            <h2 id="nearbyPlacesTitle" class="text-3xl font-semibold text-gray-900 mb-4">Eat and Drink</h2>
            <p id="nearbyPlacesDescription" class="text-gray-600 mb-8 leading-relaxed"></p>
            <div id="nearbyPlaces" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Eat and drink will be loaded dynamically -->
            </div>
        </div>
    </section>
    
    <!-- Lightbox for Ski Maps -->
    <div id="lightbox" class="hidden">
        <div id="lightboxContent">
            <button id="lightboxClose" aria-label="Close lightbox">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <button id="lightboxPrev" aria-label="Previous image">‹</button>
            <img id="lightboxImage" src="" alt="Ski map">
            <button id="lightboxNext" aria-label="Next image">›</button>
        </div>
    </div>
    
    <!-- Lightbox for Ski Maps -->
    <div id="lightbox" class="hidden">
        <div id="lightboxContent">
            <button id="lightboxClose" aria-label="Close lightbox">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <button id="lightboxPrev" aria-label="Previous image">‹</button>
            <img id="lightboxImage" src="" alt="Ski map">
            <button id="lightboxNext" aria-label="Next image">›</button>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="py-12 px-6 sm:px-8 border-t border-gray-200 bg-white">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-sm text-gray-600 mb-4 md:mb-0">
                    © 2025 <span class="bg-[var(--accent-blue)] text-white px-1">SNO</span><span class="text-[var(--accent-blue)]">GRUB</span>. All rights reserved.
                </p>
                <div class="flex space-x-6">
                    <a href="#" class="text-sm text-gray-600 hover:text-gray-900 transition-colors duration-200">About</a>
                    <a href="#" class="text-sm text-gray-600 hover:text-gray-900 transition-colors duration-200">Contact</a>
                    <a href="#" class="text-sm text-gray-600 hover:text-gray-900 transition-colors duration-200">Privacy</a>
                    <a href="#" class="text-sm text-gray-600 hover:text-gray-900 transition-colors duration-200">Terms</a>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- Load Universal Resort Card Component -->
    <script src="js/resort-card-universal.js"></script>
    <!-- Load data.js -->
    <script src="data.js"></script>
    <!-- Home Base Functionality -->
    <script src="js/homebase.js"></script>
    <script src="js/homebase-bar.js"></script>
    
    <script>
        // Get resort ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const resortId = urlParams.get('id') || 'whistler-blackcomb';
        
        // Find resort in data
        let resort = null;
        let resortMap = null;
        let trailMap = null;
        
        // Calculate distance between two coordinates using Haversine formula
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }
        
        // Helper function to generate satellite image URL using Esri World Imagery (100% FREE - No API key required)
        function getSatelliteImageUrl(lat, lng, width = 640, height = 360) {
            // Use zoom level 13 for backdrop - shows wider area around resort
            const zoom = 13;
            const scale = Math.pow(2, zoom);
            const worldCoordinateX = (lng + 180) / 360 * scale;
            const worldCoordinateY = (1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * scale;
            const tileX = Math.floor(worldCoordinateX);
            const tileY = Math.floor(worldCoordinateY);
            
            // Use Esri World Imagery for satellite view (free, no API key required)
            // For backdrop, we use the center tile - the CSS will handle scaling
            return `https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/${zoom}/${tileY}/${tileX}`;
        }
        
        // Find closest resorts (3 closest, excluding current resort, regardless of state)
        function findClosestResorts(currentResort) {
            // Check if data is available
            if (typeof skiEatsData === 'undefined' || !skiEatsData.resorts) {
                console.warn('findClosestResorts: skiEatsData not available');
                return [];
            }
            
            // Check if current resort is provided
            if (!currentResort) {
                console.warn('findClosestResorts: currentResort is not defined');
                return [];
            }
            
            // Check if current resort has valid coordinates
            if (!currentResort.coordinates || typeof currentResort.coordinates.lat !== 'number' || typeof currentResort.coordinates.lng !== 'number') {
                console.warn('findClosestResorts: currentResort missing valid coordinates', {
                    hasCoordinates: !!currentResort.coordinates,
                    lat: currentResort.coordinates?.lat,
                    lng: currentResort.coordinates?.lng,
                    resortId: currentResort.id
                });
                return [];
            }
            
            // Filter resorts that have valid coordinates and are not the current resort
            const validResorts = skiEatsData.resorts.filter(r => {
                return r.id !== currentResort.id && 
                       r.coordinates && 
                       typeof r.coordinates.lat === 'number' && 
                       typeof r.coordinates.lng === 'number';
            });
            
            if (validResorts.length === 0) {
                console.warn('findClosestResorts: No valid resorts found with coordinates');
                return [];
            }
            
            // Calculate distances and sort
            const resorts = validResorts
                .map(r => ({
                    ...r,
                    distance: calculateDistance(
                        currentResort.coordinates.lat,
                        currentResort.coordinates.lng,
                        r.coordinates.lat,
                        r.coordinates.lng
                    )
                }))
                .sort((a, b) => a.distance - b.distance)
                .slice(0, 3);
            
            console.log('findClosestResorts: found', resorts.length, 'closest resorts for', currentResort.name, resorts.map(r => ({ name: r.name, distance: r.distance.toFixed(1) })));
            return resorts;
        }
        
        // Find eat and drink (restaurants/bars/cafes) - 4 closest
        function findNearbyPlaces(currentResort) {
            const data = typeof snogrubData !== 'undefined' ? snogrubData : (typeof skiEatsData !== 'undefined' ? skiEatsData : null);
            if (!currentResort || !currentResort.coordinates || !data || !data.restaurants) {
                return [];
            }
            
            return data.restaurants
                .filter(r => r.coordinates && r.coordinates.lat && r.coordinates.lng)
                .map(r => ({
                    ...r,
                    distance: calculateDistance(
                        currentResort.coordinates.lat,
                        currentResort.coordinates.lng,
                        r.coordinates.lat,
                        r.coordinates.lng
                    )
                }))
                .sort((a, b) => a.distance - b.distance)
                .slice(0, 4);
        }
        
        // Helper function to normalize category - handles both string and array
        function normalizeCategory(category, fallback = 'restaurant') {
            if (!category) return [fallback];
            if (Array.isArray(category)) {
                return category.map(c => String(c).toLowerCase());
            }
            return [String(category).toLowerCase()];
        }
        
        // Helper function to get the primary category (first in array, or single value)
        function getPrimaryCategory(place, fallback = 'restaurant') {
            const category = place.category || place.type;
            const categories = normalizeCategory(category, fallback);
            return categories[0];
        }
        
        // Render nearby place card
        function renderNearbyPlaceCard(place) {
            const primaryCategory = getPrimaryCategory(place, 'restaurant');
            const categoryLabel = primaryCategory === 'bar' ? 'Après Bar' : primaryCategory === 'cafe' ? 'Café' : 'Restaurant';
            const categoryColors = {
                restaurant: { bg: 'from-blue-50 to-blue-100', badge: 'bg-blue-100 text-blue-700' },
                bar: { bg: 'from-amber-50 to-amber-100', badge: 'bg-amber-100 text-amber-700' },
                cafe: { bg: 'from-green-50 to-green-100', badge: 'bg-green-100 text-green-700' }
            };
            const colors = categoryColors[primaryCategory] || categoryColors.restaurant;
            const distanceText = place.distance ? `${place.distance.toFixed(1)} mi away` : '';
            
            const hasCustomImage = place.image && place.image.startsWith('http');
            const imageUrl = hasCustomImage ? place.image : null;
            
            return `
                <a href="restaurant-detail.html?id=${place.id}" class="group bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-all duration-300">
                    <div class="aspect-[16/9] bg-gradient-to-br ${colors.bg} relative overflow-hidden">
                        ${imageUrl ? `
                            <img src="${imageUrl}" 
                                 alt="${place.name}" 
                                 class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                 onerror="this.style.display='none';">
                        ` : `
                            <div class="absolute inset-0 flex items-center justify-center">
                                <svg class="w-12 h-12 ${colors.badge}" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 2L3 7v11h4v-6h6v6h4V7l-7-5z"></path>
                                </svg>
                            </div>
                        `}
                        <div class="absolute bottom-3 left-3 flex items-center gap-2">
                            <span class="inline-block px-3 py-1 text-xs font-medium rounded-full ${colors.badge}">${categoryLabel}</span>
                            ${distanceText ? `<span class="text-xs text-white bg-black/60 rounded-full px-3 py-1">${distanceText}</span>` : ''}
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-[var(--accent-blue)] transition-colors duration-200">
                            ${place.name}
                        </h3>
                        <p class="text-sm text-gray-600 mb-2">${place.location || ''}</p>
                        <div class="flex items-center gap-2 text-sm text-gray-600">
                            <svg class="w-4 h-4 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            <span>${place.rating ? `${place.rating.toFixed(1)} ★` : 'Rated soon'}</span>
                        </div>
                    </div>
                </a>
            `;
        }
        
        // Global function to toggle favorites (used by resort card component)
        window.toggleResortFavorite = window.toggleResortFavorite || function(resortId, resortName, event) {
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            try {
                const favorites = JSON.parse(localStorage.getItem('snogrub_favorites') || '[]');
                const existingIndex = favorites.findIndex(fav => fav.id === resortId && fav.type === 'resort');
                
                let isFavorited = false;
                if (existingIndex >= 0) {
                    favorites.splice(existingIndex, 1);
                    isFavorited = false;
                } else {
                    favorites.push({
                        id: resortId,
                        type: 'resort',
                        name: resortName,
                        addedAt: new Date().toISOString()
                    });
                    isFavorited = true;
                }
                localStorage.setItem('snogrub_favorites', JSON.stringify(favorites));
                
                const button = event?.target?.closest('.favorite-button');
                if (button) {
                    button.setAttribute('aria-checked', isFavorited ? 'true' : 'false');
                    if (isFavorited) {
                        button.classList.add('favorited');
                    } else {
                        button.classList.remove('favorited');
                    }
                    const icon = button.querySelector('svg');
                    if (icon) {
                        if (isFavorited) {
                            icon.classList.add('fill-red-500', 'text-red-500');
                            icon.classList.remove('fill-none', 'text-gray-400');
                            icon.setAttribute('fill', 'currentColor');
                        } else {
                            icon.classList.remove('fill-red-500', 'text-red-500');
                            icon.classList.add('fill-none', 'text-gray-400');
                            icon.setAttribute('fill', 'none');
                        }
                    }
                }
                
                window.dispatchEvent(new CustomEvent('favoritesChanged', {
                    detail: { resortId, favorited: isFavorited }
                }));
            } catch (e) {
                console.error('Error toggling favorite:', e);
            }
        };
        
        // Global function to toggle home base (used by resort card component and detail page)
        window.toggleResortHomeBase = window.toggleResortHomeBase || function(resortId, resortName, event) {
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            // Navigate to resort detail page (only if not already on that page)
            const currentUrl = new URL(window.location.href);
            const currentResortId = currentUrl.searchParams.get('id');
            
            if (currentResortId !== resortId) {
                window.location.href = `resort-detail.html?id=${resortId}`;
            }
        };
        
        // Update home base checkbox state
        function updateHomeBaseCheckbox(resortId, isHomeBase) {
            const checkbox = document.getElementById('homeBaseCheckbox');
            const label = document.getElementById('homeBaseLabel');
            const button = document.getElementById('homeBaseBtn');
            
            if (checkbox) {
                checkbox.checked = isHomeBase;
            }
            
            if (label) {
                label.textContent = isHomeBase ? 'Home Base' : 'Set as Home Base';
            }
            
            if (button) {
                if (isHomeBase) {
                    button.classList.add('bg-[var(--accent-blue)]', 'text-white', 'border-[var(--accent-blue)]');
                    button.classList.remove('bg-white', 'text-gray-700', 'border-gray-300');
                } else {
                    button.classList.remove('bg-[var(--accent-blue)]', 'text-white', 'border-[var(--accent-blue)]');
                    button.classList.add('bg-white', 'text-gray-700', 'border-gray-300');
                }
            }
        }
        
        // Initialize Universal Resort Card component
        let detailResortCard;
        if (typeof UniversalResortCard !== 'undefined') {
            detailResortCard = new UniversalResortCard({
                showLogo: true,
                showTrailMap: true,
                showStats: true,
                showRating: true,
                showPriceRating: true,
                showFeaturedBadge: true,
                showDistance: true,
                showQuickView: false,
                showHoverOverlay: true,
                imageHeight: 'h-48',
                cardVariant: 'default',
                showInlineLogo: false,
                clickable: true,
                hoverEffect: true,
                animation: true
            });
        }
        
        // Function to render resort card for closest resorts section
        function renderClosestResortCard(resort, index) {
            // Use UniversalResortCard if available
            if (detailResortCard && typeof detailResortCard.render === 'function') {
                return detailResortCard.render(resort, index);
            }
            
            // Fallback to old rendering
            const gradientColors = [
                'from-blue-50 to-cyan-50',
                'from-purple-50 to-pink-50',
                'from-green-50 to-emerald-50',
                'from-amber-50 to-orange-50'
            ];
            const gradientIndex = index % gradientColors.length;
            const randomGradient = gradientColors[gradientIndex];
            
            const distanceText = resort.distance ? `${resort.distance.toFixed(1)} mi away` : '';
            const hasImage = resort.image && resort.image.trim() !== '';
            const imageId = `closest-resort-img-${resort.id}`;
            const placeholderId = `closest-resort-placeholder-${resort.id}`;
            
            return `
                <a href="resort-detail.html?id=${resort.id}" class="group bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-all duration-300">
                    <div class="aspect-[16/9] bg-gradient-to-br ${randomGradient} relative overflow-hidden">
                        ${hasImage ? 
                            `<img id="${imageId}" src="${resort.image}" alt="${resort.name}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" onerror="document.getElementById('${imageId}').style.display='none'; document.getElementById('${placeholderId}').style.display='flex';">` :
                            ''
                        }
                        <div id="${placeholderId}" class="absolute inset-0 flex items-center justify-center ${hasImage ? 'hidden' : ''}">
                            <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2 group-hover:text-[var(--accent-blue)] transition-colors duration-200">
                            ${resort.name}
                        </h3>
                        <p class="text-sm text-gray-600 mb-2">${resort.location}</p>
                        ${distanceText ? `<p class="text-xs text-gray-500 mb-3 flex items-center gap-1">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            ${distanceText}
                        </p>` : ''}
                        <div class="flex items-center gap-2">
                            <svg class="w-4 h-4 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span class="text-sm text-gray-600">${resort.restaurantCount || 0}+ Dining Options</span>
                        </div>
                    </div>
                </a>
            `;
        }
        
        // Function to render star rating
        function renderStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let html = '';
            
            for (let i = 0; i < fullStars; i++) {
                html += '<svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>';
            }
            
            if (hasHalfStar && fullStars < 5) {
                html += '<svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>';
            }
            
            for (let i = fullStars + (hasHalfStar ? 1 : 0); i < 5; i++) {
                html += '<svg class="w-4 h-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>';
            }
            
            return html;
        }
        
        // Function to render restaurant card
        function renderRestaurantCard(restaurant, index) {
            const gradientColors = [
                'from-amber-50 to-orange-50',
                'from-red-50 to-rose-50',
                'from-green-50 to-emerald-50',
                'from-blue-50 to-cyan-50',
                'from-purple-50 to-pink-50',
                'from-indigo-50 to-blue-50'
            ];
            const gradientIndex = index % gradientColors.length;
            const randomGradient = gradientColors[gradientIndex];
            
            return `
                <a href="restaurant-detail.html?id=${restaurant.id}" class="group bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-xl transition-all duration-300 flex flex-col h-full">
                    <div class="aspect-[16/9] bg-gradient-to-br ${randomGradient} relative overflow-hidden">
                        ${restaurant.image ? 
                            `<img src="${restaurant.image}" alt="${restaurant.name}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` :
                            ''
                        }
                        <div class="absolute inset-0 flex items-center justify-center ${restaurant.image ? 'hidden' : ''}">
                            <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="p-6 flex flex-col flex-1">
                        <h3 class="text-xl font-bold text-gray-900 mb-2 leading-tight group-hover:text-[var(--accent-blue)] transition-colors duration-200">
                            ${restaurant.name}
                        </h3>
                        <p class="text-sm text-gray-600 mb-3 font-medium">${restaurant.cuisine || getPrimaryCategory(restaurant, 'Restaurant') || 'Restaurant'}</p>
                        <div class="flex items-center gap-2 mt-auto">
                            ${restaurant.rating ? `
                                <div class="flex items-center gap-1.5">
                                    <svg class="w-5 h-5 text-yellow-500 fill-current" viewBox="0 0 20 20">
                                        <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/>
                                    </svg>
                                    <span class="text-base font-bold text-gray-900">${(restaurant.rating || 0).toFixed(1)}</span>
                                </div>
                            ` : ''}
                            ${restaurant.reviewCount ? `<span class="text-sm text-gray-600">• ${restaurant.reviewCount} reviews</span>` : ''}
                        </div>
                    </div>
                </a>
            `;
        }
        
        // Function to load and display resort data
        function loadResortData() {
            if (typeof skiEatsData === 'undefined' || !skiEatsData.resorts) {
                console.error('Resort data not available');
                return;
            }
            
            resort = skiEatsData.resorts.find(r => r.id === resortId);
            
            if (!resort) {
                console.error('Resort not found:', resortId);
                
                // Try to find by name match (normalized)
                const normalizedId = resortId.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                resort = skiEatsData.resorts.find(r => {
                    const normalizedDataId = r.id.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                    const normalizedDataName = r.name.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                    return normalizedDataId === normalizedId || 
                           normalizedDataName === normalizedId ||
                           normalizedDataId.includes(normalizedId) ||
                           normalizedDataName.includes(normalizedId);
                });
                
                if (!resort) {
                    // Still not found - show error with helpful message
                    const h1 = document.querySelector('h1');
                    if (h1) {
                        h1.textContent = 'Resort Not Found';
                        h1.className = 'text-4xl sm:text-5xl font-semibold text-gray-900 mb-4 tracking-tight';
                    }
                    
                    const description = document.getElementById('resortDescription');
                    if (description) {
                        description.innerHTML = `
                            <p class="text-gray-600 leading-relaxed text-lg mb-4">
                                We couldn't find the resort "${resortId}". This resort may not be in our database yet.
                            </p>
                            <p class="text-gray-600 leading-relaxed text-lg mb-4">
                                <a href="index.html#resorts" class="text-[var(--accent-blue)] hover:underline">Browse all resorts</a> or 
                                <a href="index.html#map" class="text-[var(--accent-blue)] hover:underline">explore the map</a> to find other destinations.
                            </p>
                        `;
                    }
                    return;
                }
            }
            
            // Update page title and meta tags
            document.title = `${resort.name} - SNOGRUB`;
            
            // Update meta description
            const metaDesc = document.getElementById('metaDescription');
            if (metaDesc) {
                metaDesc.content = resort.description || `Discover the best dining options at ${resort.name} in ${resort.location}.`;
            }
            
            // Update meta keywords
            const metaKeywords = document.getElementById('metaKeywords');
            if (metaKeywords) {
                const keywords = [
                    resort.name.toLowerCase(),
                    'ski resort',
                    'dining',
                    'restaurants',
                    'après-ski',
                    resort.location.toLowerCase()
                ].join(', ');
                metaKeywords.content = keywords;
            }
            
            // Update Open Graph tags
            const ogTitle = document.getElementById('ogTitle');
            const ogDesc = document.getElementById('ogDescription');
            const ogImage = document.getElementById('ogImage');
            const ogUrl = document.querySelector('meta[property="og:url"]');
            if (ogTitle) ogTitle.content = `${resort.name} - SNOGRUB`;
            if (ogDesc) ogDesc.content = resort.description || `Discover the best dining options at ${resort.name}.`;
            if (ogImage && resort.image) ogImage.content = window.location.origin + resort.image;
            if (ogUrl) ogUrl.content = window.location.href;
            
            // Update Twitter tags
            const twitterTitle = document.getElementById('twitterTitle');
            const twitterDesc = document.getElementById('twitterDescription');
            const twitterImage = document.getElementById('twitterImage');
            if (twitterTitle) twitterTitle.content = `${resort.name} - SNOGRUB`;
            if (twitterDesc) twitterDesc.content = resort.description || `Discover the best dining options at ${resort.name}.`;
            if (twitterImage && resort.image) twitterImage.content = window.location.origin + resort.image;
            
            // Update breadcrumb
            const breadcrumb = document.getElementById('breadcrumbResortName');
            if (breadcrumb) breadcrumb.textContent = resort.name;
            
            // Update home base checkbox state
            if (typeof HomeBase !== 'undefined') {
                const isHomeBase = HomeBase.isActive() && HomeBase.getResortId() === resort.id;
                updateHomeBaseCheckbox(resort.id, isHomeBase);
                
                // Add event listener to checkbox
                const checkbox = document.getElementById('homeBaseCheckbox');
                const homeBaseBtn = document.getElementById('homeBaseBtn');
                if (checkbox && homeBaseBtn) {
                    homeBaseBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (typeof window.toggleResortHomeBase === 'function') {
                            window.toggleResortHomeBase(resort.id, resort.name, e);
                        }
                    });
                    
                    checkbox.addEventListener('change', (e) => {
                        e.stopPropagation();
                        if (typeof window.toggleResortHomeBase === 'function') {
                            window.toggleResortHomeBase(resort.id, resort.name, e);
                        }
                    });
                }
                
                // Listen for home base changes from other sources (like top bar)
                window.addEventListener('homebaseChanged', () => {
                    const isHomeBase = HomeBase.isActive() && HomeBase.getResortId() === resort.id;
                    updateHomeBaseCheckbox(resort.id, isHomeBase);
                });
            }
            
            // Update navigation links for Bars, Cafés, and Restaurants
            const barsLink = document.getElementById('barsLink');
            const cafesLink = document.getElementById('cafesLink');
            const restaurantsLink = document.getElementById('restaurantsLink');
            
            if (barsLink && resort.name) {
                barsLink.href = `bars.html?resort=${encodeURIComponent(resort.name)}`;
            }
            if (cafesLink && resort.name) {
                cafesLink.href = `restaurants.html?resort=${encodeURIComponent(resort.name)}&category=cafe`;
            }
            if (restaurantsLink && resort.name) {
                restaurantsLink.href = `restaurants.html?resort=${encodeURIComponent(resort.name)}`;
            }
            
            // Update hero stats with animations
            function animateValue(element, start, end, duration, suffix = '') {
                const range = end - start;
                const isDecimal = end % 1 !== 0 || start % 1 !== 0;
                const steps = isDecimal ? Math.abs(range * 10) : Math.abs(range);
                const stepTime = Math.abs(Math.floor(duration / steps));
                const increment = (end - start) / steps;
                let current = start;
                
                const timer = setInterval(() => {
                    current += increment;
                    if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                        element.textContent = (isDecimal ? end.toFixed(1) : end.toLocaleString()) + suffix;
                        clearInterval(timer);
                    } else {
                        element.textContent = (isDecimal ? current.toFixed(1) : current.toLocaleString()) + suffix;
                    }
                }, stepTime);
            }
            
            // Get stat values
            const verticalDrop = resort.terrain?.verticalDrop || 0;
            const liftsCount = resort.lifts?.total || 0;
            const trailsCount = resort.trails?.total || 0;
            const restaurantsCount = resort.restaurantCount || 0;
            
            // Animate vertical drop
            const verticalDropElement = document.getElementById('verticalDropValue');
            if (verticalDropElement) {
                animateValue(verticalDropElement, 0, verticalDrop, 1500, ' ft');
            }
            
            // Animate lifts count
            const liftsElement = document.getElementById('liftsValue');
            if (liftsElement) {
                animateValue(liftsElement, 0, liftsCount, 1500);
            }
            
            // Animate trails count
            const trailsElement = document.getElementById('trailsValue');
            if (trailsElement) {
                animateValue(trailsElement, 0, trailsCount, 1500);
            }
            
            // Animate restaurants count
            const restaurantsElement = document.getElementById('restaurantsValue');
            if (restaurantsElement) {
                animateValue(restaurantsElement, 0, restaurantsCount, 1500);
            }
            
            // Update Elevation
            const elevationElement = document.getElementById('elevationValue');
            if (elevationElement && resort.terrain) {
                const baseElevation = resort.terrain.baseElevation;
                const summitElevation = resort.terrain.summitElevation;
                if (baseElevation && summitElevation) {
                    elevationElement.textContent = `${baseElevation.toLocaleString()}' - ${summitElevation.toLocaleString()}'`;
                } else if (summitElevation) {
                    elevationElement.textContent = `${summitElevation.toLocaleString()}'`;
                } else {
                    elevationElement.textContent = '—';
                }
            }
            
            // Update Season Status
            const seasonElement = document.getElementById('seasonValue');
            const seasonIndicator = document.getElementById('seasonIndicator');
            if (seasonElement && resort.season) {
                const now = new Date();
                const month = now.getMonth() + 1; // 1-12
                const inSeasonMonths = [11, 12, 1, 2, 3, 4];
                const isInSeason = inSeasonMonths.includes(month);
                
                seasonElement.textContent = isInSeason ? 'Open' : 'Closed';
                seasonElement.className = `text-xl md:text-2xl font-bold mb-0.5 ${isInSeason ? 'text-green-600' : 'text-gray-500'}`;
                
                if (seasonIndicator) {
                    seasonIndicator.setAttribute('fill', isInSeason ? '#10b981' : '#6b7280');
                }
            } else if (seasonElement) {
                seasonElement.textContent = '—';
            }
            
            // Update SNOGRUB Rating
            const snogrubRatingElement = document.getElementById('snogrubRatingValue');
            if (snogrubRatingElement && resort.platformReviews) {
                const ratings = Object.values(resort.platformReviews)
                    .map(r => r.rating)
                    .filter(r => r && !isNaN(r));
                
                if (ratings.length > 0) {
                    const averageRating = ratings.reduce((sum, r) => sum + r, 0) / ratings.length;
                    animateValue(snogrubRatingElement, 0, averageRating, 1500);
                } else {
                    // Fallback to restaurant ratings if no platform reviews
                    if (resort.restaurants && Array.isArray(resort.restaurants) && resort.restaurants.length > 0) {
                        let totalRating = 0;
                        let totalReviews = 0;
                        resort.restaurants.forEach(restaurant => {
                            if (restaurant.rating && restaurant.reviewCount) {
                                totalRating += restaurant.rating * restaurant.reviewCount;
                                totalReviews += restaurant.reviewCount;
                            }
                        });
                        if (totalReviews > 0) {
                            const avgRating = totalRating / totalReviews;
                            animateValue(snogrubRatingElement, 0, avgRating, 1500);
                        } else {
                            snogrubRatingElement.textContent = '—';
                        }
                    } else {
                        snogrubRatingElement.textContent = '—';
                    }
                }
            } else if (snogrubRatingElement) {
                snogrubRatingElement.textContent = '—';
            }
            
            // Update trail difficulty breakdown
            const trailDifficultySection = document.getElementById('trailDifficultySection');
            if (trailDifficultySection && resort.trails) {
                const total = resort.trails.total || 0;
                if (total > 0) {
                    const beginner = ((resort.trails.beginner || 0) / total * 100).toFixed(0);
                    const intermediate = ((resort.trails.intermediate || 0) / total * 100).toFixed(0);
                    const advanced = ((resort.trails.advanced || 0) / total * 100).toFixed(0);
                    const expert = ((resort.trails.expert || 0) / total * 100).toFixed(0);
                    
                    // Show the section
                    trailDifficultySection.classList.remove('hidden');
                    
                    // Animate the bars
                    const animateBar = (element, targetWidth, delay = 0) => {
                        setTimeout(() => {
                            element.style.width = targetWidth + '%';
                            element.style.transition = 'width 1s ease-out';
                        }, delay);
                    };
                    
                    animateBar(document.getElementById('trailBeginnerBar'), beginner, 100);
                    animateBar(document.getElementById('trailIntermediateBar'), intermediate, 200);
                    animateBar(document.getElementById('trailAdvancedBar'), advanced, 300);
                    
                    // Update labels
                    document.getElementById('trailBeginnerPercent').textContent = beginner;
                    document.getElementById('trailIntermediatePercent').textContent = intermediate;
                    document.getElementById('trailAdvancedPercent').textContent = advanced;
                    
                    // Update tooltips
                    document.getElementById('trailBeginnerBar').setAttribute('title', `${beginner}% Beginner`);
                    document.getElementById('trailIntermediateBar').setAttribute('title', `${intermediate}% Intermediate`);
                    document.getElementById('trailAdvancedBar').setAttribute('title', `${advanced}% Advanced`);
                    
                    // Handle expert trails (only show if > 0)
                    if (parseFloat(expert) > 0) {
                        animateBar(document.getElementById('trailExpertBar'), expert, 400);
                        document.getElementById('trailExpertPercent').textContent = expert;
                        document.getElementById('trailExpertBar').setAttribute('title', `${expert}% Expert`);
                        document.getElementById('trailExpertLabel').classList.remove('hidden');
                    } else {
                        document.getElementById('trailExpertBar').style.width = '0%';
                        document.getElementById('trailExpertLabel').classList.add('hidden');
                    }
                } else {
                    trailDifficultySection.classList.add('hidden');
                }
            } else if (trailDifficultySection) {
                trailDifficultySection.classList.add('hidden');
            }
            
            // Adjust vertical drop graphic animation based on value
            if (verticalDrop > 0) {
                const altitudeBar = document.getElementById('altitudeBar');
                if (altitudeBar) {
                    // Calculate height based on vertical drop (normalize to max 5000ft for display)
                    const maxDisplay = 5000;
                    const targetHeight = Math.min((verticalDrop / maxDisplay) * 60, 60);
                    const targetY = 100 - targetHeight;
                    
                    // Set initial state
                    let currentHeight = 0;
                    let currentY = 100;
                    altitudeBar.setAttribute('height', currentHeight);
                    altitudeBar.setAttribute('y', currentY);
                    
                    // Animate to target height
                    const duration = 1500;
                    const startTime = Date.now() + 300; // Start after 300ms delay
                    
                    function animateBar() {
                        const now = Date.now();
                        if (now < startTime) {
                            requestAnimationFrame(animateBar);
                            return;
                        }
                        
                        const elapsed = now - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        
                        // Ease out cubic
                        const easeOut = 1 - Math.pow(1 - progress, 3);
                        
                        currentHeight = easeOut * targetHeight;
                        currentY = 100 - currentHeight;
                        
                        altitudeBar.setAttribute('height', currentHeight);
                        altitudeBar.setAttribute('y', currentY);
                        
                        if (progress < 1) {
                            requestAnimationFrame(animateBar);
                        }
                    }
                    
                    requestAnimationFrame(animateBar);
                }
            }
            
            // Update hero backdrop with satellite image if coordinates are available
            const heroBackdrop = document.getElementById('heroBackdrop');
            const heroBackdropImage = document.getElementById('heroBackdropImage');
            if (heroBackdrop && heroBackdropImage && resort.coordinates && resort.coordinates.lat && resort.coordinates.lng) {
                const satelliteUrl = getSatelliteImageUrl(resort.coordinates.lat, resort.coordinates.lng);
                heroBackdropImage.src = satelliteUrl;
                heroBackdrop.style.display = 'block';
                heroBackdropImage.onerror = function() {
                    // If satellite image fails to load, hide the backdrop
                    heroBackdrop.style.display = 'none';
                };
            } else if (heroBackdrop) {
                heroBackdrop.style.display = 'none';
            }
            
            // Update header
            document.getElementById('resortName').textContent = resort.name;
            document.getElementById('resortLocation').textContent = resort.location;
            document.getElementById('restaurantCount').textContent = `${resort.restaurantCount || 0}+ Dining Options`;
            
            // Update season status and today's info strip
            const seasonStatus = document.getElementById('seasonStatus');
            const todaysInfo = document.getElementById('todaysInfo');
            const todayStatus = document.getElementById('todayStatus');
            const todayHours = document.getElementById('todayHours');
            
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth() + 1; // 1-12
            
            // Simple season detection (can be enhanced with actual dates)
            let statusText = '';
            let statusColor = 'bg-gray-100 text-gray-700';
            let statusIcon = '';
            
            // Rough season estimation: Nov-Apr is typically ski season
            if (currentMonth >= 11 || currentMonth <= 4) {
                statusText = 'In Season';
                statusColor = 'bg-green-100 text-green-700';
                statusIcon = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>';
            } else {
                statusText = 'Off Season';
                statusColor = 'bg-gray-100 text-gray-700';
                statusIcon = '<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>';
            }
            
            if (resort.season && resort.season.start && resort.season.end) {
                statusText += ` (${resort.season.start} - ${resort.season.end})`;
            }
            
            // Update season status badge (if exists)
            if (seasonStatus) {
                seasonStatus.innerHTML = `
                    <span class="px-3 py-1 rounded-full text-sm font-medium flex items-center gap-2 ${statusColor}">
                        ${statusIcon}
                        ${statusText}
                    </span>
                `;
                seasonStatus.classList.remove('hidden');
            }
            
            // Today's info strip (only show if we have real data, not placeholders)
            // Note: Snowfall and weather removed until API integration is complete
            if (todaysInfo && todayStatus && todayHours) {
                // Only show if we have actual hours data (not placeholder)
                // For now, hide the entire section since hours are also placeholder
                // Uncomment below when real data is available:
                /*
                todaysInfo.classList.remove('hidden');
                
                // Status badge
                todayStatus.textContent = statusText;
                todayStatus.className = `flex items-center gap-2 text-sm font-medium px-3 py-1 rounded-full ${statusColor}`;
                
                // Hours: only show if we have real hours data
                if (resort.hours && resort.hours.open && resort.hours.close) {
                    const hoursText = `${resort.hours.open} - ${resort.hours.close}`;
                    const hoursSpan = todayHours.querySelector('span');
                    if (hoursSpan) {
                        hoursSpan.textContent = `Hours: ${hoursText}`;
                    }
                } else {
                    // Hide hours if no real data
                    todayHours.style.display = 'none';
                }
                */
                
                // Keep section hidden until real data is available
                todaysInfo.classList.add('hidden');
            }
            
            // Update description (support multiple paragraphs)
            const descriptionElement = document.getElementById('resortDescription');
            if (descriptionElement) {
                const description = resort.description || 'No description available.';
                // Split by double newlines or use single paragraph if no separators
                const paragraphs = description.split(/\n\n+/).filter(p => p.trim());
                if (paragraphs.length > 0) {
                    descriptionElement.innerHTML = paragraphs.map(p => `<p class="mb-4">${p.trim()}</p>`).join('');
                } else {
                    descriptionElement.innerHTML = `<p>${description}</p>`;
                }
            }
            
            // Display Reviews Section - Always show for all resorts
            const reviewsSection = document.getElementById('reviewsSection');
            const reviewSummariesContainer = document.getElementById('reviewSummariesContainer');
            const platformReviewsGrid = document.getElementById('platformReviewsGrid');
            const snogrubFeaturedReview = document.getElementById('snogrubFeaturedReview');
            
            // Always show reviews section
            if (reviewsSection) {
                reviewsSection.classList.remove('hidden');
            }
            
            // Check if we have platform reviews data
            const hasPlatformReviews = resort.platformReviews && Object.keys(resort.platformReviews).length > 0;
            
            // Generate SNOGRUB Featured Review
            if (snogrubFeaturedReview) {
                let averageRating = 0;
                let allPositives = [];
                let allNegatives = [];
                let platformNames = [];
                let reviewContent = '';
                
                if (hasPlatformReviews) {
                    // Calculate average rating from all platform reviews
                    const ratings = Object.values(resort.platformReviews)
                        .map(r => r.rating)
                        .filter(r => r && !isNaN(r));
                    averageRating = ratings.length > 0 
                        ? ratings.reduce((sum, r) => sum + r, 0) / ratings.length 
                        : 0;
                    
                    // Collect all positive and negative points
                    allPositives = Object.values(resort.platformReviews)
                        .map(r => r.positive)
                        .filter(p => p && p.trim());
                    allNegatives = Object.values(resort.platformReviews)
                        .map(r => r.negative)
                        .filter(n => n && n.trim());
                    
                    // Get platform names for sources
                    platformNames = Object.keys(resort.platformReviews);
                    
                    // Generate SNOGRUB review content from platform reviews
                    if (allPositives.length > 0 || allNegatives.length > 0) {
                        reviewContent = `
                            <p class="text-base">
                                After analyzing reviews from ${platformNames.length} major ski resort review platforms, I've synthesized the collective wisdom (and occasional chaos) of thousands of skiers and snowboarders who've experienced ${resort.name}. The consensus? This resort delivers a ${averageRating >= 4.0 ? 'world-class' : averageRating >= 3.5 ? 'solid' : 'mixed'} mountain experience that ${averageRating >= 4.0 ? 'lives up to' : 'has both strengths and weaknesses in'} its reputation.
                            </p>
                        `;
                        
                        if (allPositives.length > 0) {
                            // Combine positive points into a cohesive paragraph
                            const positiveSummary = allPositives.slice(0, 2).join(' ');
                            reviewContent += `
                                <p class="text-base">
                                    <strong>What makes ${resort.name} stand out:</strong> ${positiveSummary} Reviewers consistently highlight these aspects as the resort's strongest selling points, and it's easy to see why skiers keep coming back year after year.
                                </p>
                            `;
                        }
                        
                        if (allNegatives.length > 0) {
                            // Combine negative points into a balanced paragraph
                            const negativeSummary = allNegatives.slice(0, 2).join(' ');
                            reviewContent += `
                                <p class="text-base">
                                    <strong>Areas for consideration:</strong> ${negativeSummary} These are the trade-offs you'll want to factor into your decision, especially if you're planning a visit during peak season or have specific preferences about terrain or crowd levels.
                                </p>
                            `;
                        }
                        
                        reviewContent += `
                            <p class="text-base">
                                <strong>The bottom line:</strong> ${resort.name} earns a ${averageRating.toFixed(1)}-star rating based on aggregated reviews across all platforms. ${averageRating >= 4.0 ? 'This is a top-tier destination that consistently delivers exceptional skiing experiences.' : averageRating >= 3.5 ? 'This is a solid resort with plenty to offer, though it may not be perfect for everyone.' : 'This resort has its strengths but also some notable drawbacks to consider.'} Whether you're seeking ${resort.terrain?.expert ? 'challenging expert terrain' : resort.terrain?.intermediate ? 'intermediate cruising runs' : 'varied terrain'}, ${resort.name} ${averageRating >= 4.0 ? 'delivers' : 'offers'} what you're looking for—just be prepared for ${allNegatives.length > 0 ? 'the occasional crowds and variable conditions' : 'the typical resort experience'} that comes with a ${averageRating >= 4.0 ? 'world-class' : 'popular'} destination.
                            </p>
                        `;
                    } else {
                        reviewContent = `
                            <p class="text-base">
                                After analyzing reviews from ${platformNames.length} major ski resort review platforms, ${resort.name} presents a compelling case as a ${averageRating >= 4.0 ? 'top-tier' : 'solid'} ski destination. With an average rating of ${averageRating.toFixed(1)} stars across all platforms, this resort ${averageRating >= 4.0 ? 'consistently delivers' : 'offers'} exceptional mountain experiences that keep skiers and snowboarders coming back season after season.
                            </p>
                        `;
                    }
                } else {
                    // Generate default SNOWGRUB review based on resort data when no platform reviews available
                    // Estimate rating based on resort features
                    const hasLargeTerrain = resort.terrain?.skiableAcres && resort.terrain.skiableAcres > 1000;
                    const hasGoodVertical = resort.terrain?.verticalDrop && resort.terrain.verticalDrop > 2000;
                    const hasManyLifts = resort.lifts?.total && resort.lifts.total > 5;
                    const hasManyTrails = resort.trails?.total && resort.trails.total > 50;
                    
                    // Calculate estimated rating (3.5-4.5 range based on features)
                    let featureScore = 0;
                    if (hasLargeTerrain) featureScore += 0.3;
                    if (hasGoodVertical) featureScore += 0.3;
                    if (hasManyLifts) featureScore += 0.2;
                    if (hasManyTrails) featureScore += 0.2;
                    averageRating = 3.5 + (featureScore * 1.0); // Range: 3.5 to 4.5
                    
                    // Build review content from resort description and features
                    const terrainDesc = resort.terrain?.expert ? 'expert terrain' : 
                                      resort.terrain?.intermediate ? 'intermediate-friendly slopes' : 
                                      'diverse terrain';
                    const locationDesc = resort.location || 'its location';
                    
                    reviewContent = `
                        <p class="text-base">
                            ${resort.name} is a ${hasLargeTerrain ? 'substantial' : 'well-regarded'} ski destination located in ${locationDesc}. Based on the resort's features and reputation, this mountain offers ${terrainDesc} that ${hasLargeTerrain ? 'attracts' : 'appeals to'} skiers and snowboarders of all ability levels.
                        </p>
                    `;
                    
                    // Add positive aspects based on available data
                    const positives = [];
                    if (hasLargeTerrain && resort.terrain.skiableAcres) {
                        positives.push(`${resort.terrain.skiableAcres.toLocaleString()} skiable acres`);
                    }
                    if (hasGoodVertical && resort.terrain.verticalDrop) {
                        positives.push(`${resort.terrain.verticalDrop.toLocaleString()} feet of vertical drop`);
                    }
                    if (hasManyLifts && resort.lifts.total) {
                        positives.push(`${resort.lifts.total} lifts`);
                    }
                    if (hasManyTrails && resort.trails.total) {
                        positives.push(`${resort.trails.total} trails`);
                    }
                    
                    if (positives.length > 0) {
                        reviewContent += `
                            <p class="text-base">
                                <strong>What makes ${resort.name} stand out:</strong> The resort features ${positives.join(', ')}, providing ${hasLargeTerrain ? 'extensive' : 'solid'} terrain options for visitors. ${resort.description ? resort.description.split('.')[0] + '.' : 'This mountain offers a quality skiing experience that keeps guests coming back.'}
                            </p>
                        `;
                    }
                    
                    reviewContent += `
                        <p class="text-base">
                            <strong>The bottom line:</strong> ${resort.name} is a ${averageRating >= 4.0 ? 'top-tier' : 'solid'} ski destination that ${averageRating >= 4.0 ? 'delivers' : 'offers'} ${terrainDesc} and ${hasLargeTerrain ? 'extensive' : 'quality'} mountain experiences. Whether you're seeking ${resort.terrain?.expert ? 'challenging expert terrain' : resort.terrain?.intermediate ? 'intermediate cruising runs' : 'varied terrain'}, ${resort.name} has something to offer for every skier and snowboarder.
                        </p>
                    `;
                }
                
                // Set SNOGRUB review content
                const snogrubReviewContent = document.getElementById('snogrubReviewContent');
                if (snogrubReviewContent) {
                    snogrubReviewContent.innerHTML = reviewContent;
                }
                
                // Set stars
                const snogrubStars = document.getElementById('snogrubStars');
                if (snogrubStars) {
                    snogrubStars.innerHTML = renderStars(averageRating);
                }
                
                // Set rating
                const snogrubRating = document.getElementById('snogrubRating');
                if (snogrubRating) {
                    snogrubRating.textContent = averageRating.toFixed(1);
                }
                
                // Set sources
                const snogrubSources = document.getElementById('snogrubSources');
                if (snogrubSources) {
                    if (hasPlatformReviews && platformNames.length > 0) {
                        const sourceColors = {
                            'PeakRankings': 'bg-blue-100 text-blue-700',
                            'SkiResort.info': 'bg-green-100 text-green-700',
                            'PowderHounds': 'bg-purple-100 text-purple-700',
                            'Ski North America 100': 'bg-orange-100 text-orange-700',
                            'OnTheSnow': 'bg-cyan-100 text-cyan-700',
                            'Snow Magazine': 'bg-indigo-100 text-indigo-700'
                        };
                        
                        const sourcesHTML = platformNames.map(name => {
                            const colorClass = sourceColors[name] || 'bg-gray-100 text-gray-700';
                            return `<span class="px-2 py-1 ${colorClass} rounded">${name}</span>`;
                        }).join('');
                        
                        snogrubSources.innerHTML = `<span class="font-medium">Sources aggregated:</span>${sourcesHTML}`;
                        snogrubSources.classList.remove('hidden');
                    } else {
                        snogrubSources.innerHTML = `<span class="font-medium">Review based on:</span> <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded">Resort Features & Data</span>`;
                        snogrubSources.classList.remove('hidden');
                    }
                }
                
                // Show SNOGRUB review
                snogrubFeaturedReview.classList.remove('hidden');
            }
            
            // Platform source configuration
            const platformConfig = {
                'PeakRankings': { name: 'PeakRankings', icon: 'PR', colorClass: 'bg-blue-100', textColorClass: 'text-blue-700' },
                'SkiResort.info': { name: 'SkiResort.info', icon: 'SR', colorClass: 'bg-green-100', textColorClass: 'text-green-700' },
                'PowderHounds': { name: 'PowderHounds', icon: 'PH', colorClass: 'bg-purple-100', textColorClass: 'text-purple-700' },
                'Ski North America 100': { name: 'Ski North America 100', icon: 'SNA', colorClass: 'bg-orange-100', textColorClass: 'text-orange-700' },
                'OnTheSnow': { name: 'OnTheSnow', icon: 'OTS', colorClass: 'bg-cyan-100', textColorClass: 'text-cyan-700' },
                'Snow Magazine': { name: 'Snow Magazine', icon: 'SM', colorClass: 'bg-indigo-100', textColorClass: 'text-indigo-700' }
            };
            
            let reviewsHTML = '';
            
            if (hasPlatformReviews) {
                // Generate review summaries from platform reviews
                Object.keys(resort.platformReviews).forEach(platformKey => {
                    const review = resort.platformReviews[platformKey];
                    const config = platformConfig[platformKey] || { 
                        name: platformKey, 
                        icon: platformKey.substring(0, 2).toUpperCase(), 
                        colorClass: 'bg-gray-100', 
                        textColorClass: 'text-gray-700' 
                    };
                    
                    // Generate stars using existing function
                    const starsHTML = renderStars(review.rating);
                    
                    const hasUrl = review.url && review.url.trim() !== '';
                    const reviewCount = review.reviewCount ? review.reviewCount.toLocaleString() : '';
                    
                    reviewsHTML += `
                        <div class="bg-white border border-gray-200 rounded-xl p-5 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 ${config.colorClass} rounded-full flex items-center justify-center">
                                        <span class="${config.textColorClass} font-semibold text-xs">${config.icon}</span>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${config.name}</h4>
                                    </div>
                                </div>
                                <div class="flex items-center gap-1">
                                    ${starsHTML}
                                    <span class="text-sm font-medium text-gray-700 ml-1">${review.rating.toFixed(1)}</span>
                                </div>
                            </div>
                            ${reviewCount ? `<p class="text-xs text-gray-500 mb-3">${reviewCount} reviews</p>` : ''}
                            ${review.positive ? `
                                <div class="mb-3">
                                    <p class="text-xs font-medium text-green-700 mb-1">Positive</p>
                                    <p class="text-gray-600 leading-relaxed text-sm">${review.positive}</p>
                                </div>
                            ` : ''}
                            ${review.negative ? `
                                <div>
                                    <p class="text-xs font-medium text-red-700 mb-1">Negative</p>
                                    <p class="text-gray-600 leading-relaxed text-sm">${review.negative}</p>
                                </div>
                            ` : ''}
                            ${hasUrl ? `
                                <a href="${review.url}" 
                                   target="_blank" 
                                   rel="noopener noreferrer"
                                   class="inline-flex items-center gap-2 text-sm font-medium text-[var(--accent-blue)] hover:text-blue-700 transition-colors mt-3">
                                    <span>View reviews on ${config.name}</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </a>
                            ` : ''}
                        </div>
                    `;
                });
            } else {
                // Show placeholder message when no platform reviews are available
                reviewsHTML = `
                    <div class="bg-white border border-gray-200 rounded-xl p-5 text-center">
                        <p class="text-gray-600 text-sm">Review summaries from major platforms will be available soon.</p>
                    </div>
                `;
            }
            
            // Always populate the reviews grid
            if (platformReviewsGrid) {
                platformReviewsGrid.innerHTML = reviewsHTML;
            }
            
            // Update quick stats
            const quickStats = document.getElementById('quickStats');
            let statsHTML = '';
            if (resort.terrain && resort.terrain.skiableAcres) {
                statsHTML += `<div class="bg-white border border-gray-200 rounded-lg p-4 text-center">
                    <div class="text-2xl font-semibold text-gray-900">${resort.terrain.skiableAcres.toLocaleString()}</div>
                    <div class="text-sm text-gray-600 mt-1">Acres</div>
                </div>`;
            }
            if (resort.terrain && resort.terrain.verticalDrop) {
                statsHTML += `<div class="bg-white border border-gray-200 rounded-lg p-4 text-center">
                    <div class="text-2xl font-semibold text-gray-900">${resort.terrain.verticalDrop.toLocaleString()}</div>
                    <div class="text-sm text-gray-600 mt-1">Vertical Drop (ft)</div>
                </div>`;
            }
            if (resort.lifts && resort.lifts.total) {
                statsHTML += `<div class="bg-white border border-gray-200 rounded-lg p-4 text-center">
                    <div class="text-2xl font-semibold text-gray-900">${resort.lifts.total}</div>
                    <div class="text-sm text-gray-600 mt-1">Lifts</div>
                </div>`;
            }
            if (resort.trails && resort.trails.total) {
                statsHTML += `<div class="bg-white border border-gray-200 rounded-lg p-4 text-center">
                    <div class="text-2xl font-semibold text-gray-900">${resort.trails.total}</div>
                    <div class="text-sm text-gray-600 mt-1">Trails</div>
                </div>`;
            }
            quickStats.innerHTML = statsHTML || '';
            
            // Load restaurants for this resort
            // Filter by resort ID (normalized comparison) and also by proximity
            const normalizedResortId = resort.id.toLowerCase().replace(/[^a-z0-9]+/g, '-');
            let allRestaurants = (skiEatsData.restaurants || []).filter(r => {
                if (!r.resort) return false;
                // Normalize both IDs for comparison
                const normalizedRestaurantResort = r.resort.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                return normalizedRestaurantResort === normalizedResortId;
            });
            
            // If we have resort coordinates, also filter by proximity (within 20 miles) as a safety check
            // This ensures we only show restaurants actually near this resort
            if (resort.coordinates) {
                allRestaurants = allRestaurants
                    .filter(r => {
                        if (!r.coordinates || !r.coordinates.lat || !r.coordinates.lng) return false;
                        const distance = calculateDistance(
                            resort.coordinates.lat,
                            resort.coordinates.lng,
                            r.coordinates.lat,
                            r.coordinates.lng
                        );
                        // Only include restaurants within 20 miles of the resort
                        return distance <= 20;
                    })
                    .map(r => ({
                        ...r,
                        distance: calculateDistance(
                            resort.coordinates.lat,
                            resort.coordinates.lng,
                            r.coordinates.lat,
                            r.coordinates.lng
                        )
                    }))
                    .sort((a, b) => a.distance - b.distance);
            } else {
                // If no coordinates, just use the resort ID filter
                allRestaurants = allRestaurants.map(r => ({
                    ...r,
                    distance: Infinity
                }));
            }
            
            const restaurantsGrid = document.getElementById('restaurantsGrid');
            const diningSection = restaurantsGrid ? restaurantsGrid.closest('.mb-12') : null;
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            
            // State for pagination
            let displayedCount = 3;
            const itemsPerPage = 3;
            
            // Function to render restaurants
            function renderRestaurants(count) {
                const restaurantsToShow = allRestaurants.slice(0, count);
                restaurantsGrid.innerHTML = restaurantsToShow.map((r, i) => renderRestaurantCard(r, i)).join('');
                
                // Show/hide MORE button
                if (loadMoreContainer && loadMoreBtn) {
                    if (count >= allRestaurants.length) {
                        loadMoreContainer.classList.add('hidden');
                    } else {
                        loadMoreContainer.classList.remove('hidden');
                    }
                }
            }
            
            // Load more button handler
            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', () => {
                    displayedCount += itemsPerPage;
                    renderRestaurants(displayedCount);
                });
            }
            
            if (allRestaurants.length > 0) {
                // Show dining section and update title
                if (diningSection) {
                    diningSection.style.display = 'block';
                }
                
                // Update title with resort name for SEO
                const diningTitle = document.getElementById('diningSectionTitle');
                if (diningTitle) {
                    diningTitle.textContent = `Eat and Drink at ${resort.name}`;
                }
                
                // Update description with SEO-friendly content
                const diningDescription = document.getElementById('diningSectionDescription');
                if (diningDescription) {
                    const restaurantCount = allRestaurants.length;
                    const restaurantText = restaurantCount === 1 ? 'restaurant' : 'restaurants';
                    const cuisineTypes = [...new Set(allRestaurants.map(r => r.cuisine || r.category).filter(Boolean))];
                    const cuisineText = cuisineTypes.length > 0 ? ` featuring ${cuisineTypes.slice(0, 3).join(', ')}${cuisineTypes.length > 3 ? ' and more' : ''}` : '';
                    
                    let description = `Discover ${restaurantCount} ${restaurantText}${cuisineText} near ${resort.name}, offering diverse dining options from casual cafés to fine dining establishments. `;
                    
                    // Add location-specific food and drink information
                    if (resort.location) {
                        description += `The ${resort.location} area boasts a vibrant culinary scene with local specialties and craft beverages that reflect the region's unique character. `;
                        description += `Whether you're looking for après-ski favorites, farm-to-table cuisine, or international flavors, ${resort.location} offers an array of dining experiences to satisfy every palate.`;
                    } else {
                        description += `The area surrounding ${resort.name} features a diverse culinary landscape with local dining establishments and beverage options that showcase regional flavors. `;
                        description += `From cozy mountain lodges to contemporary restaurants, visitors can enjoy a variety of food and drink options that complement the ski resort experience.`;
                    }
                    
                    diningDescription.textContent = description;
                }
                
                // Initially show only 3 restaurants
                renderRestaurants(displayedCount);
            } else {
                // Hide the entire dining section when no restaurants found
                if (diningSection) {
                    diningSection.style.display = 'none';
                }
            }
            
            // Update resort information
            const resortInfo = document.getElementById('resortInfo');
            let infoHTML = '';
            
            if (resort.terrain) {
                if (resort.terrain.skiableAcres) {
                    infoHTML += `<div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                            <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                            </svg>
                            Ski Terrain
                        </h3>
                        <p class="text-gray-600">${resort.terrain.skiableAcres.toLocaleString()} acres of skiable terrain</p>
                    </div>`;
                }
                if (resort.terrain.verticalDrop) {
                    infoHTML += `<div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                            <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12"></path>
                            </svg>
                            Vertical Drop
                        </h3>
                        <p class="text-gray-600">${resort.terrain.verticalDrop.toLocaleString()} ft</p>
                    </div>`;
                }
                if (resort.terrain.baseElevation && resort.terrain.summitElevation) {
                    infoHTML += `<div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                            <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            Elevation
                        </h3>
                        <p class="text-gray-600">Base: ${resort.terrain.baseElevation.toLocaleString()} ft | Summit: ${resort.terrain.summitElevation.toLocaleString()} ft</p>
                    </div>`;
                }
            }
            
            if (resort.lifts) {
                let liftText = `${resort.lifts.total} lifts`;
                if (resort.lifts.notable) {
                    liftText += ` including ${resort.lifts.notable}`;
                }
                if (resort.lifts.hourlyCapacity) {
                    liftText += ` (${resort.lifts.hourlyCapacity.toLocaleString()} skiers/hour capacity)`;
                }
                infoHTML += `<div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                        <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Lifts
                    </h3>
                    <p class="text-gray-600">${liftText}</p>
                </div>`;
            }
            
            if (resort.trails) {
                let trailText = `${resort.trails.total || 0} trails`;
                if (resort.trails.beginner || resort.trails.intermediate || resort.trails.advanced) {
                    const percentages = [];
                    if (resort.trails.beginner) percentages.push(`${resort.trails.beginner}% beginner`);
                    if (resort.trails.intermediate) percentages.push(`${resort.trails.intermediate}% intermediate`);
                    if (resort.trails.advanced) percentages.push(`${resort.trails.advanced}% advanced`);
                    if (resort.trails.expert) percentages.push(`${resort.trails.expert}% expert`);
                    if (percentages.length > 0) {
                        trailText += ` (${percentages.join(', ')})`;
                    }
                }
                if (resort.trails.longestRun) {
                    trailText += ` | Longest run: ${resort.trails.longestRun}`;
                }
                if (resort.trails.terrainParks) {
                    trailText += ` | ${resort.trails.terrainParks} terrain park${resort.trails.terrainParks > 1 ? 's' : ''}`;
                }
                infoHTML += `<div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                        <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                        </svg>
                        Trails
                    </h3>
                    <p class="text-gray-600">${trailText}</p>
                </div>`;
            }
            
            if (resort.season) {
                let seasonText = '';
                if (resort.season.start && resort.season.end) {
                    seasonText = `Season: ${resort.season.start} - ${resort.season.end}`;
                }
                if (resort.season.averageSnowfall) {
                    seasonText += seasonText ? ` | Average Snowfall: ${resort.season.averageSnowfall}"` : `Average Snowfall: ${resort.season.averageSnowfall}"`;
                }
                if (seasonText) {
                    infoHTML += `<div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                            <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                            Season
                        </h3>
                        <p class="text-gray-600">${seasonText}</p>
                    </div>`;
                }
            }
            
            resortInfo.innerHTML = infoHTML || '<p class="text-gray-600">Resort information coming soon.</p>';
            
            // Update travel information
            const travelInfo = document.getElementById('travelInfo');
            let travelHTML = '';
            
            if (resort.travel) {
                if (resort.travel.drivingDirections) {
                    travelHTML += `<div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                            <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                            </svg>
                            By Car
                        </h3>
                        <p class="text-gray-600">${resort.travel.drivingDirections}</p>
                    </div>`;
                }
                if (resort.travel.nearestAirport) {
                    let airportText = resort.travel.nearestAirport;
                    if (resort.travel.airportDistance) {
                        airportText += ` - ${resort.travel.airportDistance} drive`;
                    }
                    travelHTML += `<div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                            <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            By Air
                        </h3>
                        <p class="text-gray-600">${airportText}</p>
                    </div>`;
                }
                if (resort.travel.shuttleService) {
                    travelHTML += `<div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h3 class="font-semibold text-gray-900 mb-2 flex items-center gap-2">
                            <svg class="w-5 h-5 text-[var(--accent-blue)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                            </svg>
                            Shuttle Service
                        </h3>
                        <p class="text-gray-600">${resort.travel.shuttleService}</p>
                    </div>`;
                }
            }
            
            travelInfo.innerHTML = travelHTML || '<p class="text-gray-600">Travel information coming soon.</p>';
            
            // Initialize map with resort coordinates
            if (resort.coordinates) {
                resortMap = L.map('resortMap', {
                    scrollWheelZoom: false
                }).setView([resort.coordinates.lat, resort.coordinates.lng], 13);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(resortMap);
                
                // Add resort marker
                L.marker([resort.coordinates.lat, resort.coordinates.lng], {
                    icon: L.divIcon({
                        className: 'resort-marker',
                        html: '<div style="width: 40px; height: 40px; background: #0071e3; border: 3px solid white; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><svg width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg></div>',
                        iconSize: [40, 40],
                        iconAnchor: [20, 20]
                    })
                }).addTo(resortMap)
                .bindPopup(`<strong>${resort.name}</strong><br>${resort.location}`);
                
                // Add restaurant markers
                if (typeof allRestaurants !== 'undefined' && allRestaurants.length > 0) {
                    allRestaurants.forEach(restaurant => {
                        if (restaurant.coordinates) {
                            L.marker([restaurant.coordinates.lat, restaurant.coordinates.lng], {
                                icon: L.divIcon({
                                    className: 'restaurant-marker',
                                    html: '<div style="width: 24px; height: 24px; background: #10b981; border: 2px solid white; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>',
                                    iconSize: [24, 24],
                                    iconAnchor: [12, 12]
                                })
                            }).addTo(resortMap)
                            .bindPopup(`<strong>${restaurant.name}</strong>`);
                        }
                    });
                }
                
                // Initialize trail map with ski trail data
                // Note: OpenSkiMap.org blocks iframe embedding, so we use OpenSnowMap tiles for trail overlay
                // and provide a link to OpenSkiMap.org for the full interactive experience
                if (resort.coordinates) {
                    // Focus on ski trails with higher zoom level (16-17 for trail detail)
                    // Adjust view slightly higher/elevation to focus on mountain trails rather than base village
                    const trailFocusLat = resort.coordinates.lat + 0.005; // Shift slightly north/up the mountain
                    trailMap = L.map('trailMap', {
                        scrollWheelZoom: false
                    }).setView([trailFocusLat, resort.coordinates.lng], 16);
                    
                    // Winter-themed base map layer (CartoDB Positron for cleaner winter look)
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                        attribution: '© OpenStreetMap contributors © CARTO',
                        maxZoom: 19,
                        subdomains: 'abcd'
                    }).addTo(trailMap);
                    
                    // Ski trail overlay layer (OpenSnowMap provides compatible trail tiles)
                    // These tiles show ski trails, lifts, and terrain features
                    const trailLayer = L.tileLayer('https://tiles.opensnowmap.org/pistes/{z}/{x}/{y}.png', {
                        attribution: 'Trail data from <a href="https://openskimap.org/" target="_blank">OpenSkiMap.org</a> | Map data © <a href="https://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors ODBL',
                        maxZoom: 18,
                        opacity: 0.9, // Slightly more opaque to emphasize trails
                        className: 'ski-trail-layer' // Add class for CSS filtering
                    }).addTo(trailMap);
                    
                    // Add resort marker with winter theme
                    L.marker([resort.coordinates.lat, resort.coordinates.lng], {
                        icon: L.divIcon({
                            className: 'resort-marker',
                            html: '<div style="width: 40px; height: 40px; background: #0ea5e9; border: 3px solid white; border-radius: 50%; box-shadow: 0 2px 8px rgba(14, 165, 233, 0.4); display: flex; align-items: center; justify-content: center;"><svg width="20" height="20" fill="white" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg></div>',
                            iconSize: [40, 40],
                            iconAnchor: [20, 20]
                        })
                    }).addTo(trailMap)
                    .bindPopup(`<strong>${resort.name}</strong><br>${resort.location}<br><a href="https://openskimap.org/#16/${trailFocusLat}/${resort.coordinates.lng}" target="_blank" style="color: #0ea5e9; text-decoration: underline;">View on OpenSkiMap.org →</a>`);
                }
            }
            
            // Load ski maps from Skimap.org
            loadSkiMaps(resort);
            
            // Update Skimap.org links to point to the specific resort page
            updateSkimapLinks(resort);
            
            // Update structured data for SEO
            const schemaScript = document.getElementById('resortSchema');
            if (schemaScript && resort) {
                const locationParts = (resort.location || '').split(',').map(s => s.trim());
                const schema = {
                    "@context": "https://schema.org",
                    "@type": "TouristAttraction",
                    "name": resort.name,
                    "image": resort.image || '',
                    "description": resort.description || `Ski resort in ${resort.location}`,
                    "address": {
                        "@type": "PostalAddress",
                        "addressLocality": locationParts[0] || resort.location,
                        "addressRegion": locationParts[1] || '',
                        "addressCountry": resort.location && resort.location.includes('QC') ? 'CA' : 
                                         resort.location && resort.location.includes('BC') ? 'CA' : 
                                         resort.location && resort.location.includes('Canada') ? 'CA' : 'US'
                    },
                    "geo": {
                        "@type": "GeoCoordinates",
                        "latitude": resort.coordinates.lat,
                        "longitude": resort.coordinates.lng
                    },
                    "url": window.location.href
                };
                
                schemaScript.textContent = JSON.stringify(schema, null, 2);
            }
            
            // Load closest resorts
            const closestResorts = findClosestResorts(resort);
            const closestResortsContainer = document.getElementById('closestResorts');
            
            if (closestResortsContainer) {
                if (closestResorts.length > 0) {
                    closestResortsContainer.innerHTML = closestResorts.map((r, index) => renderClosestResortCard(r, index)).join('');
                } else {
                    closestResortsContainer.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            <p class="text-gray-500 text-lg mb-2">No nearby resorts found</p>
                            <p class="text-gray-400 text-sm mb-4">Explore all resorts to discover more destinations</p>
                            <a href="resorts.html" class="inline-block px-6 py-3 bg-[var(--accent-blue)] text-white rounded-full font-medium hover:opacity-90 transition-opacity">
                                Browse All Resorts
                            </a>
                        </div>
                    `;
                }
            }
            
            // Load eat and drink (restaurants/bars/cafes)
            // Hide this section for wisp-resort
            if (resortId === 'wisp-resort') {
                const nearbyPlacesContainer = document.getElementById('nearbyPlaces');
                if (nearbyPlacesContainer) {
                    const eatAndDrinkSection = nearbyPlacesContainer.closest('section');
                    if (eatAndDrinkSection) {
                        eatAndDrinkSection.style.display = 'none';
                    }
                }
            } else {
                const nearbyPlaces = findNearbyPlaces(resort);
                const nearbyPlacesContainer = document.getElementById('nearbyPlaces');
                
                // Update title and description for SEO
                const nearbyPlacesTitle = document.getElementById('nearbyPlacesTitle');
                const nearbyPlacesDescription = document.getElementById('nearbyPlacesDescription');
                
                if (nearbyPlacesTitle) {
                    nearbyPlacesTitle.textContent = `Eat and Drink at ${resort.name}`;
                }
                
                if (nearbyPlacesDescription && nearbyPlaces.length > 0) {
                    const placeCount = nearbyPlaces.length;
                    const placeText = placeCount === 1 ? 'place' : 'places';
                    const categories = [...new Set(nearbyPlaces.map(p => p.category).filter(Boolean))];
                    const categoryText = categories.length > 0 ? ` including ${categories.slice(0, 3).join(', ')}${categories.length > 3 ? ' and more' : ''}` : '';
                    
                    let description = `Explore ${placeCount} nearby dining and drinking ${placeText}${categoryText} around ${resort.name}. `;
                    
                    // Add location-specific food and drink information
                    if (resort.location) {
                        description += `The ${resort.location} area offers a rich culinary experience with local restaurants, bars, and cafés that capture the essence of mountain dining. `;
                        description += `From craft breweries and wine bars to family-friendly eateries and upscale dining, ${resort.location} provides diverse food and beverage options that enhance your ski resort visit.`;
                    } else {
                        description += `The area surrounding ${resort.name} features a variety of dining establishments and beverage venues that cater to all tastes and preferences. `;
                        description += `Whether you're seeking a quick bite, a relaxing après-ski drink, or a memorable dining experience, you'll find excellent food and drink options near the resort.`;
                    }
                    
                    nearbyPlacesDescription.textContent = description;
                } else if (nearbyPlacesDescription) {
                    nearbyPlacesDescription.textContent = '';
                }
                
                if (nearbyPlacesContainer) {
                    if (nearbyPlaces.length > 0) {
                        nearbyPlacesContainer.innerHTML = nearbyPlaces.map(renderNearbyPlaceCard).join('');
                    } else {
                        nearbyPlacesContainer.innerHTML = `
                            <div class="col-span-full text-center py-12">
                                <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                                </svg>
                                <p class="text-gray-500 text-lg mb-2">No nearby eat and drink found</p>
                                <p class="text-gray-400 text-sm mb-4">Explore more restaurants, cafés, and après spots</p>
                                <a href="restaurants.html" class="inline-block px-6 py-3 bg-[var(--accent-blue)] text-white rounded-full font-medium hover:opacity-90 transition-opacity">
                                    Browse Places
                                </a>
                            </div>
                        `;
                    }
                }
            }
        }
        
        // Ski Maps Gallery and Lightbox
        let skiMaps = [];
        let currentMapIndex = 0;
        
        /**
         * Mapping of resort IDs to Skimap.org ski area IDs
         * This can be populated by searching Skimap.org and finding the ski area ID from the URL
         * Example: https://skimap.org/skiareas/view/1234 -> skiAreaId: 1234
         */
        /**
         * Mapping of resort IDs to Skimap.org ski area IDs
         * 
         * To populate this mapping:
         * 1. Visit https://skimap.org/
         * 2. Search for the resort name
         * 3. Click on the resort's page
         * 4. Look at the URL: https://skimap.org/skiareas/view/{id}
         * 5. Add the ID to this mapping: 'resort-id': skiAreaId
         * 
         * Example:
         * - Visit https://skimap.org/?q=whistler
         * - Find "Whistler Blackcomb" and click it
         * - URL shows: https://skimap.org/skiareas/view/1234
         * - Add: 'whistler-blackcomb': 1234
         * 
         * You can also use the findSkimapSkiAreaId() function in the browser console
         * to help find IDs: findSkimapSkiAreaId('resort name')
         */
        const skimapResortMapping = {
            // Add your mappings here as you find them on Skimap.org
            // Format: 'resort-id-from-data-js': skimapSkiAreaId
        };
        
        /**
         * Generate the Skimap.org URL for a specific resort
         * @param {Object} resort - The resort object
         * @returns {string} The URL to the resort's page on Skimap.org
         */
        function getSkimapUrl(resort) {
            if (!resort) {
                return 'https://skimap.org/';
            }
            
            // Check if we have a mapping for this resort
            const skiAreaId = skimapResortMapping[resort.id];
            
            if (skiAreaId) {
                // Use the direct ski area page URL
                return `https://skimap.org/skiareas/view/${skiAreaId}`;
            } else {
                // Fall back to search URL with resort name
                const searchQuery = encodeURIComponent(resort.name);
                return `https://skimap.org/?q=${searchQuery}`;
            }
        }
        
        /**
         * Update Skimap.org links on the page to point to the specific resort
         * @param {Object} resort - The resort object
         */
        function updateSkimapLinks(resort) {
            const skimapUrl = getSkimapUrl(resort);
            const link1 = document.getElementById('skimapLink1');
            const link2 = document.getElementById('skimapLink2');
            
            if (link1) {
                link1.href = skimapUrl;
            }
            if (link2) {
                link2.href = skimapUrl;
            }
        }
        
        /**
         * Helper function to search for a ski area ID on Skimap.org
         * Usage: Open browser console and run: findSkimapSkiAreaId('Whistler Blackcomb')
         * This will search Skimap.org and try to find the ski area ID
         */
        window.findSkimapSkiAreaId = async function(resortName) {
            try {
                const searchUrl = `https://skimap.org/?q=${encodeURIComponent(resortName)}`;
                console.log(`Searching Skimap.org for: ${resortName}`);
                console.log(`Visit: ${searchUrl}`);
                console.log('Then click on the resort and check the URL for the ski area ID');
                console.log('The ID is in the URL: https://skimap.org/skiareas/view/{ID}');
                
                // Try to fetch search results (may fail due to CORS)
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                try {
                    const response = await fetch(proxyUrl + encodeURIComponent(searchUrl));
                    if (response.ok) {
                        const html = await response.text();
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        
                        // Look for links to ski areas
                        const links = doc.querySelectorAll('a[href*="/skiareas/view/"]');
                        const results = [];
                        links.forEach(link => {
                            const match = link.href.match(/\/skiareas\/view\/(\d+)/);
                            if (match) {
                                results.push({
                                    name: link.textContent.trim(),
                                    id: match[1],
                                    url: link.href
                                });
                            }
                        });
                        
                        if (results.length > 0) {
                            console.log('Found potential matches:');
                            results.forEach(r => {
                                console.log(`  - ${r.name}: ID ${r.id} (${r.url})`);
                            });
                            return results;
                        }
                    }
                } catch (e) {
                    console.log('Could not fetch search results automatically. Please visit the search URL manually.');
                }
                
                return null;
            } catch (error) {
                console.error('Error searching:', error);
                return null;
            }
        };
        
        /**
         * Fetch ski maps from Skimap.org using a CORS proxy
         * @param {string|number} skiAreaId - The Skimap.org ski area ID
         * @returns {Promise<Array>} Array of map objects
         */
        async function fetchSkiMapsFromSkimap(skiAreaId) {
            try {
                // Use a CORS proxy to fetch the ski area page
                // Try multiple proxy services for reliability
                const proxies = [
                    'https://api.allorigins.win/raw?url=',
                    'https://corsproxy.io/?',
                    'https://api.codetabs.com/v1/proxy?quest='
                ];
                
                const skimapUrl = `https://skimap.org/skiareas/view/${skiAreaId}`;
                let html = null;
                let lastError = null;
                
                // Try each proxy until one works
                for (const proxyUrl of proxies) {
                    try {
                        const response = await fetch(proxyUrl + encodeURIComponent(skimapUrl), {
                            method: 'GET',
                            headers: {
                                'Accept': 'text/html'
                            }
                        });
                        
                        if (response.ok) {
                            html = await response.text();
                            break;
                        }
                    } catch (error) {
                        lastError = error;
                        continue;
                    }
                }
                
                if (!html) {
                    throw lastError || new Error('All proxy attempts failed');
                }
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Extract map information from the HTML
                const maps = [];
                
                // Try multiple selectors to find map elements
                const mapSelectors = [
                    '[id^="ski-map-"]',
                    '.ski-map',
                    '.map-item',
                    '[data-map-id]',
                    'a[href*="#ski-map-"]'
                ];
                
                let mapElements = [];
                for (const selector of mapSelectors) {
                    mapElements = doc.querySelectorAll(selector);
                    if (mapElements.length > 0) break;
                }
                
                // If no specific map elements found, look for images in map-related containers
                if (mapElements.length === 0) {
                    const mapContainers = doc.querySelectorAll('.map, .skiarea-map, [class*="map"]');
                    mapContainers.forEach(container => {
                        const img = container.querySelector('img');
                        if (img) {
                            mapElements.push(container);
                        }
                    });
                }
                
                mapElements.forEach((element) => {
                    const mapId = element.id?.replace('ski-map-', '') || 
                                 element.dataset?.mapId || 
                                 element.href?.match(/#ski-map-(\d+)/)?.[1] ||
                                 Math.random().toString(36).substr(2, 9);
                    
                    const img = element.querySelector('img') || (element.tagName === 'IMG' ? element : null);
                    const titleElement = element.querySelector('h3, h4, h5, h6, .title, .map-title, [class*="title"]') ||
                                       element.closest('div, article, section')?.querySelector('h3, h4, h5, h6, .title');
                    
                    const titleText = titleElement?.textContent?.trim() || 
                                    element.title || 
                                    element.alt ||
                                    `Ski Map`;
                    
                    const yearMatch = titleText.match(/\b(19|20)\d{2}\b/);
                    
                    if (img) {
                        let thumbnail = img.src || img.dataset.src || img.dataset.original || img.getAttribute('data-lazy-src');
                        let fullImage = thumbnail;
                        
                        // Try to construct full image URL from thumbnail
                        if (thumbnail) {
                            // Handle relative URLs
                            if (!thumbnail.startsWith('http')) {
                                thumbnail = thumbnail.startsWith('/') 
                                    ? `https://skimap.org${thumbnail}`
                                    : `https://skimap.org/${thumbnail}`;
                            }
                            
                            // Try to get full-size image
                            fullImage = thumbnail
                                .replace('/thumbnails/', '/')
                                .replace('_thumb', '')
                                .replace('_small', '')
                                .replace('thumbnail', '')
                                .replace('thumb', '');
                        }
                        
                        maps.push({
                            thumbnail: thumbnail || '',
                            fullImage: fullImage || thumbnail || '',
                            year: yearMatch ? yearMatch[0] : null,
                            title: titleText,
                            url: `https://skimap.org/skiareas/view/${skiAreaId}#ski-map-${mapId}`,
                            mapId: mapId
                        });
                    }
                });
                
                // Remove duplicates and filter out invalid entries
                const uniqueMaps = maps.filter((map, index, self) => 
                    map.thumbnail && 
                    index === self.findIndex(m => m.mapId === map.mapId)
                );
                
                // Sort by year (most recent first), then by title
                uniqueMaps.sort((a, b) => {
                    if (a.year && b.year) {
                        return parseInt(b.year) - parseInt(a.year);
                    }
                    if (a.year) return -1;
                    if (b.year) return 1;
                    return a.title.localeCompare(b.title);
                });
                
                return uniqueMaps;
            } catch (error) {
                console.error('Error fetching ski maps from Skimap.org:', error);
                return [];
            }
        }
        
        /**
         * Load ski maps for a resort from Skimap.org
         */
        async function loadSkiMaps(resort) {
            const gallery = document.getElementById('skiMapsGallery');
            const section = document.getElementById('skiMapsSection');
            
            if (!gallery || !section) return;
            
            // Show loading state
            gallery.innerHTML = `
                <div class="col-span-full text-center py-8">
                    <svg class="animate-spin h-8 w-8 text-[var(--accent-blue)] mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="text-gray-600">Loading ski maps...</p>
                </div>
            `;
            section.classList.remove('hidden');
            
            // Check if we have a mapping for this resort
            const skiAreaId = skimapResortMapping[resort.id];
            
            if (skiAreaId) {
                // Try to fetch maps from Skimap.org
                const maps = await fetchSkiMapsFromSkimap(skiAreaId);
                
                if (maps && maps.length > 0) {
                    displaySkiMaps(maps);
                    return;
                }
            }
            
            // Fallback: Show search link if no mapping or fetch failed
            const skimapUrl = getSkimapUrl(resort);
            
            gallery.innerHTML = `
                <div class="col-span-full text-center py-8">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path>
                    </svg>
                    <p class="text-gray-600 mb-2">Ski maps for ${resort.name}</p>
                    <p class="text-sm text-gray-500 mb-4">Visit Skimap.org to find and view trail maps for this resort</p>
                    <a href="${skimapUrl}" target="_blank" rel="noopener noreferrer" class="inline-block px-6 py-3 bg-[var(--accent-blue)] text-white rounded-lg font-medium hover:opacity-90 transition-opacity">
                        Browse Maps on Skimap.org
                    </a>
                    <p class="text-xs text-gray-400 mt-4">
                        To enable automatic map loading, add this resort to the skimapResortMapping object with its Skimap.org ski area ID
                    </p>
                </div>
            `;
        }
        
        /**
         * Display ski maps in the gallery
         * @param {Array} maps - Array of map objects with {thumbnail, fullImage, year, title, url}
         */
        function displaySkiMaps(maps) {
            const gallery = document.getElementById('skiMapsGallery');
            const section = document.getElementById('skiMapsSection');
            
            if (!gallery || !section || !maps || maps.length === 0) {
                if (section) section.classList.add('hidden');
                return;
            }
            
            skiMaps = maps;
            
            gallery.innerHTML = maps.map((map, index) => `
                <div class="ski-map-thumbnail" data-index="${index}" onclick="openLightbox(${index})" role="button" tabindex="0" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();openLightbox(${index})}">
                    <img src="${map.thumbnail || map.fullImage}" alt="${map.title || `Ski map ${map.year || ''}`}" loading="lazy" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'300\'%3E%3Crect fill=\'%23f3f4f6\' width=\'400\' height=\'300\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%239ca3af\' font-family=\'system-ui\' font-size=\'14\'%3EMap unavailable%3C/text%3E%3C/svg%3E'">
                    ${map.year ? `<div class="ski-map-year">${map.year}</div>` : ''}
                    <div class="absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity bg-black bg-opacity-20">
                        <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"></path>
                        </svg>
                    </div>
                </div>
            `).join('');
            
            section.classList.remove('hidden');
        }
        
        /**
         * Open lightbox with ski map
         * @param {number} index - Index of the map in the skiMaps array
         */
        window.openLightbox = function(index) {
            if (!skiMaps || skiMaps.length === 0) return;
            
            currentMapIndex = index;
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightboxImage');
            const map = skiMaps[index];
            
            if (lightbox && lightboxImage) {
                lightboxImage.src = map.fullImage || map.thumbnail;
                lightboxImage.alt = map.title || `Ski map ${map.year || ''}`;
                lightbox.classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Update navigation buttons visibility
                const prevBtn = document.getElementById('lightboxPrev');
                const nextBtn = document.getElementById('lightboxNext');
                if (prevBtn) prevBtn.style.display = skiMaps.length > 1 ? 'flex' : 'none';
                if (nextBtn) nextBtn.style.display = skiMaps.length > 1 ? 'flex' : 'none';
            }
        };
        
        /**
         * Close lightbox
         */
        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            if (lightbox) {
                lightbox.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        /**
         * Navigate to previous map in lightbox
         */
        function prevMap() {
            if (skiMaps.length === 0) return;
            currentMapIndex = (currentMapIndex - 1 + skiMaps.length) % skiMaps.length;
            openLightbox(currentMapIndex);
        }
        
        /**
         * Navigate to next map in lightbox
         */
        function nextMap() {
            if (skiMaps.length === 0) return;
            currentMapIndex = (currentMapIndex + 1) % skiMaps.length;
            openLightbox(currentMapIndex);
        }
        
        // Lightbox event listeners
        document.addEventListener('DOMContentLoaded', () => {
            const lightbox = document.getElementById('lightbox');
            const lightboxClose = document.getElementById('lightboxClose');
            const lightboxPrev = document.getElementById('lightboxPrev');
            const lightboxNext = document.getElementById('lightboxNext');
            
            if (lightboxClose) {
                lightboxClose.addEventListener('click', closeLightbox);
            }
            
            if (lightboxPrev) {
                lightboxPrev.addEventListener('click', prevMap);
            }
            
            if (lightboxNext) {
                lightboxNext.addEventListener('click', nextMap);
            }
            
            // Close on background click
            if (lightbox) {
                lightbox.addEventListener('click', (e) => {
                    if (e.target === lightbox) {
                        closeLightbox();
                    }
                });
            }
            
            // Close on Escape key, navigate with arrow keys
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowLeft' && lightbox && lightbox.classList.contains('active')) {
                    prevMap();
                } else if (e.key === 'ArrowRight' && lightbox && lightbox.classList.contains('active')) {
                    nextMap();
                }
            });
        });
        
        // Load resort data when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadResortData);
        } else {
            loadResortData();
        }
        
        // Weather functionality removed until API integration
        // When ready to integrate:
        // 1. Add weather API (e.g., OpenWeatherMap, WeatherAPI)
        // 2. Uncomment and implement weather display
        // 3. Add weather button back to HTML if needed
        /*
        const weatherButton = document.getElementById('todayWeather');
        if (weatherButton) {
            weatherButton.addEventListener('click', async () => {
                const lat = weatherButton.dataset.lat;
                const lng = weatherButton.dataset.lng;
                // Fetch weather data from API
                // Display in modal or expand section
            });
        }
        */
        
        // Add to Trip Functionality
        const addToTripBtn = document.getElementById('addToTripBtn');
        if (addToTripBtn) {
            addToTripBtn.addEventListener('click', () => {
                if (resort && typeof addToTrip === 'function') {
                    addToTrip(
                        resort.id,
                        resort.name,
                        resort.location,
                        'resort',
                        null
                    );
                } else if (resort) {
                    // Fallback: redirect to trips page
                    window.location.href = 'trips.html';
                } else {
                    // Use page data
                    const resortName = document.getElementById('resortName')?.textContent || 'Resort';
                    const resortLocation = document.getElementById('resortLocation')?.textContent || 'Location';
                    if (typeof addToTrip === 'function') {
                        addToTrip(resortId, resortName, resortLocation, 'resort', null);
                    } else {
                        window.location.href = 'trips.html';
                    }
                }
            });
        }
        
        // Share Functionality
        const shareBtn = document.getElementById('shareBtn');
        if (shareBtn) {
            shareBtn.addEventListener('click', async () => {
                const resortName = document.getElementById('resortName')?.textContent || 'Ski Resort';
                const resortLocation = document.getElementById('resortLocation')?.textContent || '';
                const shareData = {
                    title: `${resortName} - SNOGRUB`,
                    text: `Check out ${resortName}${resortLocation ? ` in ${resortLocation}` : ''}! Discover the best dining options at this ski resort.`,
                    url: window.location.href
                };
                
                try {
                    if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
                        await navigator.share(shareData);
                    } else {
                        // Fallback: copy to clipboard
                        await navigator.clipboard.writeText(window.location.href);
                        alert('Link copied to clipboard!');
                    }
                } catch (error) {
                    if (error.name !== 'AbortError') {
                        // Fallback: copy to clipboard
                        try {
                            await navigator.clipboard.writeText(window.location.href);
                            alert('Link copied to clipboard!');
                        } catch (clipboardError) {
                            console.error('Error sharing:', clipboardError);
                        }
                    }
                }
            });
        }
        
        // Listen for home base changes to update checkbox
        window.addEventListener('homebaseChanged', () => {
            if (typeof resort !== 'undefined' && resort && typeof HomeBase !== 'undefined') {
                const isHomeBase = HomeBase.isActive() && HomeBase.getResortId() === resort.id;
                updateHomeBaseCheckbox(resort.id, isHomeBase);
            }
        });
    </script>
</body>
</html>

